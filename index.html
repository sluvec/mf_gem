<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Demo - Portable Version</title>
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Enhanced Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" role="dialog" aria-labelledby="loading-title" aria-describedby="loading-message">
        <div class="loading-container">
            <div class="loading-spinner" aria-hidden="true"></div>
            <h2 id="loading-title" class="loading-title">Loading...</h2>
            <p id="loading-message" class="loading-message">Please wait while we prepare your data</p>
            <div class="loading-progress">
                <div class="progress-track">
                    <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
                </div>
                <div id="progress-text" class="progress-text">0%</div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Toast Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-label="Notifications">
        <!-- Toasts will be dynamically added here -->
    </div>
    
    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay" style="background: rgba(0,0,0,0.8); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; display: none;">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 0.5rem; min-width: 400px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="margin: 0 0 0.5rem 0; color: #1f2937; font-size: 1.5rem;">🔐 Login to CRM Demo</h2>
                <p style="margin: 0; color: #6b7280;">Please select your user account to continue</p>
            </div>
            
            <form id="login-form" style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div>
                    <label for="user-select" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Select User:</label>
                    <select id="user-select" required style="width: 100%; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem; background: white;">
                        <option value="">-- Choose User --</option>
                        <option value="Slav">👨‍💼 Slav</option>
                        <option value="Rob">👨‍💻 Rob</option>
                        <option value="Kayleigh">👩‍💼 Kayleigh</option>
                        <option value="Terry">👨‍🔧 Terry</option>
                        <option value="Phil">👨‍📊 Phil</option>
                    </select>
                </div>
                
                <button type="submit" style="background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.375rem; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s;">
                    🚀 Login to System
                </button>
            </form>
        </div>
    </div>
    
    <header role="banner">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-left">
                <h1>
                    <button 
                        data-show-page="dashboard" 
                        aria-label="Go to dashboard - CRM Demo homepage"
                        class="logo-btn">
                        🏢 CRM Demo
                    </button>
                </h1>
                
                <!-- Mobile hamburger menu toggle -->
                <button 
                    id="mobile-menu-toggle" 
                    class="mobile-menu-toggle" 
                    aria-expanded="false"
                    aria-controls="main-navigation"
                    aria-label="Toggle main navigation menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                
                <ul id="main-navigation" class="nav-menu nav-grid" role="menubar" aria-label="Main menu">
                    <!-- Row 1: Core Navigation -->
                    <li role="none" class="nav-row-1">
                        <button 
                            data-show-page="dashboard" 
                            class="nav-btn active"
                            role="menuitem"
                            aria-pressed="true"
                            aria-describedby="dashboard-desc">
                            <span class="nav-icon">🏠</span>
                            Dashboard
                        </button>
                    </li>
                    
                    <li role="none" class="nav-row-1">
                        <button 
                            data-show-page="pcnumbers" 
                            class="nav-btn"
                                    role="menuitem"
                                    aria-describedby="pc-numbers-desc">
                            <span class="nav-icon">📋</span>
                                    PC Numbers
                                </button>
                            </li>
                    
                    <li role="none" class="nav-row-1">
                        <button 
                            data-show-page="quotes" 
                            class="nav-btn"
                                    role="menuitem"
                                    aria-describedby="quotes-desc">
                            <span class="nav-icon">📝</span>
                                    Quotes
                                </button>
                            </li>
                    
                    <li role="none" class="nav-row-1">
                                <button 
                            data-show-page="activities" 
                            class="nav-btn"
                                    role="menuitem"
                                    aria-describedby="activities-desc">
                            <span class="nav-icon">📅</span>
                                    Activities
                                </button>
                    </li>
                    
                    <li role="none" class="nav-row-1">
                                <button 
                            data-show-page="pricelists" 
                            class="nav-btn"
                                    role="menuitem"
                                    aria-describedby="pricelists-desc">
                            <span class="nav-icon">💷</span>
                                    Price Lists
                                </button>
                    </li>
                    
                    <li role="none" class="nav-row-1">
                        <button 
                            data-show-page="resources" 
                            class="nav-btn"
                            role="menuitem"
                            aria-describedby="resources-desc">
                            <span class="nav-icon">🛠️</span>
                            Resources
                        </button>
                    </li>
                </ul>
            </div>
                            <div class="nav-right">
                    <!-- User Info Display -->
                    <div id="user-info" style="display: none; align-items: center; gap: 1rem; margin-right: 1rem;">
                        <div style="background: #f3f4f6; padding: 0.5rem 1rem; border-radius: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.2rem;">👤</span>
                            <span id="current-user-name" style="font-weight: 500; color: #374151;"></span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button 
                                onclick="window.showChangeUserModal()" 
                                class="nav-btn secondary"
                                style="padding: 0.25rem 0.5rem; font-size: 0.875rem;"
                                aria-label="Change current user">
                                🔄 Change User
                            </button>
                            <button 
                                onclick="window.logoutUser()" 
                                class="nav-btn danger"
                                style="padding: 0.25rem 0.5rem; font-size: 0.875rem;"
                                aria-label="Logout current user">
                                🚪 Logout
                            </button>
                        </div>
                    </div>

                    <button 
                        data-show-page="settings" 
                        class="nav-btn"
                        role="menuitem"
                        aria-describedby="settings-desc">
                        <span class="nav-icon">⚙️</span>
                        Settings
                    </button>
                </div>
        </nav>
    </header>
    
    <!-- Screen reader descriptions for navigation items -->
    <div class="sr-only">
        <div id="dashboard-desc">Overview of key metrics and recent activity</div>
        <div id="pc-numbers-desc">Manage project codes and client information</div>
        <div id="quotes-desc">Create and manage quotes for projects</div>
        <div id="activities-desc">Schedule and track project activities</div>
        <div id="resources-desc">Manage equipment, materials and labor resources</div>
        <div id="pricelists-desc">Manage pricing and rate cards</div>
        <div id="settings-desc">System settings, data export and import options</div>
    </div>



    <main id="main-content" role="main" tabindex="-1">
        <div class="container">
            <div id="dashboard" class="page active">
            <h1>📊 Dashboard</h1>
            <p>Overview of key metrics in the demonstration system.</p>
            

            

            
            <div class="stats">
                <div class="stat-card clickable" data-show-page="pcnumbers">
                    <h3>PC Numbers</h3>
                    <div class="value" id="stat-pc">0</div>
                </div>
                <div class="stat-card clickable" data-show-page="quotes">
                    <h3>Quotes</h3>
                    <div class="value" id="stat-quotes">0</div>
                </div>
                <div class="stat-card clickable" data-show-page="activities">
                    <h3>Activities</h3>
                    <div class="value" id="stat-activities">0</div>
                </div>
                <div class="stat-card">
                    <h3>Quote Value</h3>
                    <div class="value" id="stat-value">£0</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <h2>🚀 Quick Actions</h2>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button 
                        data-show-page="new-pc" 
                        class="button primary" 
                        style="padding: 0.75rem 1.5rem; font-size: 1rem;">
                        📋 New PC Number
                    </button>
                    <button 
                        onclick="window.showNewQuoteModal()" 
                        class="button primary" 
                        style="padding: 0.75rem 1.5rem; font-size: 1rem;">
                        💰 New Quote
                    </button>
                    <button 
                        onclick="window.showActivityModal()" 
                        class="button primary" 
                        style="padding: 0.75rem 1.5rem; font-size: 1rem;">
                        📅 New Activity
                    </button>
                </div>
            </div>

            <!-- Recent Data Tables -->
            <div class="card">
                <h2>Recent PC Numbers</h2>
                <table>
                    <thead>
                        <tr><th>PC Number</th><th>Company</th><th>Reference</th><th>Created</th></tr>
                    </thead>
                    <tbody id="recent-pc"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>Recent Quotes</h2>
                <table>
                    <thead>
                        <tr><th>Quote Number</th><th>PC Number</th><th>Client Name</th><th>Value</th><th>Status</th><th>Created</th></tr>
                    </thead>
                    <tbody id="recent-quotes"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>Recent Activities</h2>
                <table>
                    <thead>
                        <tr><th>Title</th><th>Type</th><th>Quote</th><th>Status</th><th>Scheduled Date</th><th>Created</th></tr>
                    </thead>
                    <tbody id="recent-activities"></tbody>
                </table>
            </div>
        </div>

        <div id="pcnumbers" class="page">
            <h1>🔢 PC Numbers</h1>
            <button data-show-page="new-pc">+ New PC Number</button>
            
            <!-- Smart Filter -->
            <div class="card" style="margin-bottom: 1rem;">
                <h3 style="margin-bottom: 0.75rem;">🔍 Smart Filter</h3>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <label for="pc-filter-company" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Company Name:</label>
                        <input 
                            type="text" 
                            id="pc-filter-company" 
                            placeholder="Start typing company name..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterPcNumbersByCompany(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <label for="pc-filter-account-manager" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Account Manager:</label>
                        <input 
                            type="text" 
                            id="pc-filter-account-manager" 
                            placeholder="Start typing account manager..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterPcNumbersByAccountManager(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <label for="pc-filter-pc-number" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">PC Number:</label>
                        <input 
                            type="text" 
                            id="pc-filter-pc-number" 
                            placeholder="Start typing PC number..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterPcNumbersByPcNumber(this.value)"
                        >
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button onclick="window.clearPcFilter()" class="secondary">Clear Filter</button>
                    </div>
                </div>
                <div id="pc-filter-results" style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;"></div>
            </div>
            
            <div class="card">
                <h2>PC Numbers List</h2>
                <table>
                    <thead><tr>
                        <th class="sortable" data-sort="pcNumber">PC Number ↕</th>
                        <th class="sortable" data-sort="company">Company ↕</th>
                        <th class="sortable" data-sort="projectTitle">Reference ↕</th>
                        <th class="sortable" data-sort="contactName">Contact ↕</th>
                        <th class="sortable" data-sort="accountManager">Account Manager ↕</th>
                        <th class="sortable" data-sort="lastModifiedAt">Date Modified ↕</th>
                        <th>Actions</th>
                    </tr></thead>
                    <tbody id="pc-list"></tbody>
                </table>
            </div>
        </div>

        <div id="new-pc" class="page">
            <h1 id="pc-form-title">New PC Number</h1>
            
            <!-- Simple Single-Page Form -->
            <div style="max-width: 800px; margin: 0 auto;">
                <form id="pc-form" novalidate>
                    <input type="hidden" id="pc-id">
                    
                    <!-- PC Number (Hidden - Auto-Generated) -->
                    <input type="hidden" id="pc-number">
                    
                    <!-- Basic Information -->
                    <div class="form-section">
                        <h3>Basic Information</h3>
                        <div class="form-grid">
                            <div>
                                <label>Company Name *</label>
                                <input type="text" id="pc-company-name" required placeholder="Enter company name">
                            </div>
                            <div>
                                <label>Project Name</label>
                                <input type="text" id="pc-project-name" placeholder="Enter project name">
                            </div>
                            <div>
                                <label>Account Manager *</label>
                                <input type="text" id="pc-account-manager" required placeholder="Account manager name">
                            </div>
                        </div>

                        <div>
                            <label>Project Description</label>
                            <textarea id="pc-project-description" rows="3" placeholder="Describe the project requirements, scope, and any special considerations..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Client Details (Account Manager moved to Basic Info; Industry moved to Classification) -->
                    <div class="form-section" style="display:none;"></div>
                    
                    <!-- Classification & Management -->
                    <div class="form-section">
                        <h3>Classification & Management</h3>
                        <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <div>
                                <label>Industry</label>
                                <select id="pc-industry">
                                    <option value="">Select industry...</option>
                                    <option value="Business Services (Consulting & Accounting)">Business Services (Consulting & Accounting)</option>
                                    <option value="Charities & Non-Profit">Charities & Non-Profit</option>
                                    <option value="Construction & Real Estate">Construction & Real Estate</option>
                                    <option value="Defence">Defence</option>
                                    <option value="Financial Services">Financial Services</option>
                                    <option value="Government / Public Administration">Government / Public Administration</option>
                                    <option value="Healthcare & NHS">Healthcare & NHS</option>
                                    <option value="Legal">Legal</option>
                                    <option value="Life Sciences & Pharmaceuticals">Life Sciences & Pharmaceuticals</option>
                                    <option value="Logistics & Transportation">Logistics & Transportation</option>
                                    <option value="Manufacturing & Engineering">Manufacturing & Engineering</option>
                                    <option value="Media & Entertainment">Media & Entertainment</option>
                                    <option value="Police & Emergency Services">Police & Emergency Services</option>
                                    <option value="Retail & E-commerce">Retail & E-commerce</option>
                                    <option value="Technology & Software">Technology & Software</option>
                                    <option value="Telecommunications">Telecommunications</option>
                                </select>
                            </div>
                            <div>
                                <label>Client Category</label>
                                <select id="pc-client-category">
                                    <option value="">Select category...</option>
                                    <option value="public">Public</option>
                                    <option value="private">Private</option>
                                    <option value="non-profit">Non-Profit</option>
                                </select>
                            </div>
                            <div>
                                <label>Client Source</label>
                                <select id="pc-client-source">
                                    <option value="External">External</option>
                                    <option value="Internal CFA UK">Internal CFA UK</option>
                                    <option value="Internal CIM UK">Internal CIM UK</option>
                                    <option value="Internal Crown APAC">Internal Crown APAC</option>
                                    <option value="Internal Crown EMEA">Internal Crown EMEA</option>
                                    <option value="Internal CWS IT Renew">Internal CWS IT Renew</option>
                                    <option value="Internal CWS Interiors">Internal CWS Interiors</option>
                                    <option value="Internal CWS Office Resale">Internal CWS Office Resale</option>
                                </select>
                            </div>
                            <div>
                                <label>Client Source Detail</label>
                                <select id="pc-client-source-detail">
                                    <option value="">Select detail...</option>
                                    <option value="Cold Outreach">Cold Outreach</option>
                                    <option value="Direct Enquiry">Direct Enquiry</option>
                                    <option value="Email Campaign">Email Campaign</option>
                                    <option value="Existing Client">Existing Client</option>
                                    <option value="Media/PR">Media/PR</option>
                                    <option value="Networking Event">Networking Event</option>
                                    <option value="Online Marketplace/Directory">Online Marketplace/Directory</option>
                                    <option value="Partner/Reseller">Partner/Reseller</option>
                                    <option value="PPC/Ads">PPC/Ads</option>
                                    <option value="RFP/Tender Portal">RFP/Tender Portal</option>
                                    <option value="Social Media">Social Media</option>
                                    <option value="Trade Show/Exhibition">Trade Show/Exhibition</option>
                                    <option value="Web Enquiry">Web Enquiry</option>
                                </select>
                            </div>
                        </div>


                        <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <div>
                                <label>SIC Code 1</label>
                                <input type="text" id="pc-sic-code-1" placeholder="Primary SIC code">
                                <small>Standard Industrial Classification</small>
                            </div>
                            <div>
                                <label>SIC Code 2</label>
                                <input type="text" id="pc-sic-code-2" placeholder="Secondary SIC code">
                            </div>
                            <div>
                                <label>SIC Code 3</label>
                                <input type="text" id="pc-sic-code-3" placeholder="Tertiary SIC code">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="form-section">
                        <h3>Contact Information</h3>
                        <div class="form-grid">
                            <div>
                                <label>First Name *</label>
                                <input type="text" id="pc-contact-first-name" required placeholder="First name">
                            </div>
                            <div>
                                <label>Last Name *</label>
                                <input type="text" id="pc-contact-last-name" required placeholder="Last name">
                            </div>
                            <div>
                                <label>Client Title</label>
                                <input type="text" id="pc-contact-client-title" placeholder="e.g. Mr, Ms, Dr, ...">
                            </div>
                            <div>
                                <label>Client Job Title</label>
                                <input type="text" id="pc-contact-job-title" placeholder="e.g. Operations Manager">
                            </div>
                            <div>
                                <label>Phone Number</label>
                                <input type="tel" id="pc-contact-phone" placeholder="+44 20 7123 4567">
                            </div>
                            <div>
                                <label>Email Address</label>
                                <input type="email" id="pc-contact-email" placeholder="email@address.com">
                            </div>
                        </div>
                    </div>

                    <!-- Address -->
                    <div class="form-section">
                        <h3>Address</h3>
                        <div class="form-grid">
                            <div>
                                <label>Postcode *</label>
                                <input type="text" id="pc-address-postcode" required placeholder="SW1A 1AA">
                            </div>
                            <div>
                                <label>Address Line 1</label>
                                <input type="text" id="pc-address-1" placeholder="Building number and street">
                            </div>
                            <div>
                                <label>Address Line 2</label>
                                <input type="text" id="pc-address-2" placeholder="Floor, suite, apartment">
                            </div>
                            <div>
                                <label>Address Line 3</label>
                                <input type="text" id="pc-address-3" placeholder="District/area">
                            </div>
                            <div>
                                <label>Address Line 4</label>
                                <input type="text" id="pc-address-4" placeholder="City/town">
                            </div>
                            <div>
                                <label>Country</label>
                                <input type="text" id="pc-address-country" value="United Kingdom" placeholder="United Kingdom">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="form-actions" style="margin-top: 2rem;">
                        <button type="submit">✓ Create PC Number</button>
                        <button type="button" onclick="window.showPage('pc-numbers')" class="secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="pc-detail" class="page">
            <h1 id="pc-detail-title">PC Details</h1>
            
            <!-- Main Data -->
            <div class="card">
                <h2>Main Project Data</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div><strong>PC Number:</strong> <span id="pc-detail-number"></span></div>
                    <div><strong>Company Name:</strong> <span id="pc-detail-company-name"></span></div>
                    <div><strong>Project Name:</strong> <span id="pc-detail-project-name"></span></div>
                    <div><strong>Account Manager:</strong> <span id="pc-detail-account-manager"></span></div>
                    <div><strong>Client Industry:</strong> <span id="pc-detail-client-industry"></span></div>
                    <div><strong>Client Source:</strong> <span id="pc-detail-client-source"></span></div>
                    <div><strong>Quote Limit:</strong> <span id="pc-detail-quote-limit"></span></div>
                    <div><strong>Status:</strong> <span id="pc-detail-status"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Project Description:</strong><br>
                    <span id="pc-detail-project-description" style="white-space: pre-wrap;"></span>
                </div>
                <div class="form-actions">
                    <button onclick="window.editPC(window.currentPC.id)" class="warning">Edit</button>
                    <button onclick="window.showNewQuoteModal()">Create Quote</button>
                    <button onclick="window.showActivityModal()">Add Activity</button>
                    <button data-show-page="pcnumbers" class="secondary">Back to list</button>
                </div>
            </div>
            
            <!-- Classification & Management -->
            <div class="card">
                <h2>Classification & Management</h2>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div><strong>Client Category:</strong> <span id="pc-detail-client-category"></span></div>
                    <div><strong>Client Source:</strong> <span id="pc-detail-client-source"></span></div>
                    <div><strong>Client Source Detail:</strong> <span id="pc-detail-client-source-detail"></span></div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div><strong>SIC Code 1:</strong> <span id="pc-detail-sic-code-1"></span></div>
                    <div><strong>SIC Code 2:</strong> <span id="pc-detail-sic-code-2"></span></div>
                    <div><strong>SIC Code 3:</strong> <span id="pc-detail-sic-code-3"></span></div>
                </div>
            </div>

            <!-- Address -->
            <div class="card">
                <h2>Address</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div><strong>Postcode:</strong> <span id="pc-detail-address-postcode"></span></div>
                    <div><strong>Address Line 1:</strong> <span id="pc-detail-address-1"></span></div>
                    <div><strong>Address Line 2:</strong> <span id="pc-detail-address-2"></span></div>
                    <div><strong>Address Line 3:</strong> <span id="pc-detail-address-3"></span></div>
                    <div><strong>Address Line 4:</strong> <span id="pc-detail-address-4"></span></div>
                    <div><strong>Country:</strong> <span id="pc-detail-address-country"></span></div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="card">
                <h2>Primary Contact</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div><strong>Contact Name:</strong> <span id="pc-detail-contact-name"></span></div>
                    <div><strong>Phone:</strong> <span id="pc-detail-contact-phone"></span></div>
                    <div><strong>Email:</strong> <span id="pc-detail-contact-email"></span></div>
                    <div><strong>Postcode:</strong> <span id="pc-detail-postcode"></span></div>
                </div>
                <p class="field-note">Note: Detailed addresses are now managed in individual quotes.</p>
            </div>
            <div class="card">
                <h2>Related Quotes</h2>
                <table>
                    <thead><tr><th>Quote Number</th><th>Title</th><th>Value</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="pc-quotes"></tbody>
                </table>
            </div>
            <div class="card">
                <h2>Related Activities</h2>
                <table>
                     <thead><tr><th>ID</th><th>Type</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="pc-activities"></tbody>
                </table>
            </div>
        </div>
        
        <div id="quotes" class="page">
            <h1>💰 Quotes</h1>
            <button onclick="window.showNewQuoteModal()">+ New Quote</button>
            
            <!-- Smart Filter -->
            <div class="card" style="margin-bottom: 1rem;">
                <h3 style="margin-bottom: 0.75rem;">🔍 Smart Filter</h3>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <label for="quote-filter-company" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Company Name:</label>
                        <input 
                            type="text" 
                            id="quote-filter-company" 
                            placeholder="Start typing company name..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterQuotesByCompany(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <label for="quote-filter-account-manager" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Account Manager:</label>
                        <input 
                            type="text" 
                            id="quote-filter-account-manager" 
                            placeholder="Start typing account manager..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterQuotesByAccountManager(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <label for="quote-filter-pc-number" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">PC Number:</label>
                        <input 
                            type="text" 
                            id="quote-filter-pc-number" 
                            placeholder="Start typing PC number..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterQuotesByPcNumber(this.value)"
                        >
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button onclick="window.clearQuoteFilter()" class="secondary">Clear Filter</button>
                    </div>
                </div>
                <div id="quote-filter-results" style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;"></div>
            </div>
            
            <div class="card">
                <h2>Quote List</h2>
                <table>
                    <thead><tr>
                        <th class="sortable" data-sort="quoteNumber">Quote Number ↕</th>
                        <th class="sortable" data-sort="pcNumber">PC Number ↕</th>
                        <th class="sortable" data-sort="clientName">Company ↕</th>
                        <th class="sortable" data-sort="totalAmount">Value ↕</th>
                        <th class="sortable" data-sort="status">Status ↕</th>
                        <th class="sortable" data-sort="accountManager">Account Manager ↕</th>
                        <th class="sortable" data-sort="lastModifiedAt">Date Modified ↕</th>
                        <th>Actions</th>
                    </tr></thead>
                    <tbody id="quotes-list"></tbody>
                </table>
            </div>
        </div>
        
        <div id="quote-builder" class="page">
            <h1 id="quote-builder-title">New Quote</h1>
            <div class="card" id="builder-step-client">
                <h2>Step 1: Client & Project</h2>
                <div class="form-grid">
                    <div>
                        <label>Client Name *</label>
                        <input type="text" id="builder-client-name" placeholder="Client company name" oninput="window.app && window.app.builderUpdatePcDropdown && window.app.builderUpdatePcDropdown()">
                    </div>
                    <div>
                        <label>Account Manager *</label>
                        <select id="builder-account-manager">
                            <option value="">Select Account Manager...</option>
                            <option value="John Smith">John Smith</option>
                            <option value="Sarah Johnson">Sarah Johnson</option>
                            <option value="Mike Wilson">Mike Wilson</option>
                            <option value="Emma Brown">Emma Brown</option>
                            <option value="David Lee">David Lee</option>
                        </select>
                    </div>
                    <div>
                        <label>Property Type</label>
                        <select id="builder-property-type">
                            <option value="">Select Property Type...</option>
                            <option>Office with IT equipment</option>
                            <option>Office without IT equipment</option>
                            <option>Museum</option>
                            <option>Warehouse</option>
                            <option>Laboratory</option>
                            <option>Domestic - Individual</option>
                            <option>Library</option>
                            <option>Gallery</option>
                        </select>
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label>PC Number (type or select)</label>
                        <div style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items:center;">
                            <input type="text" id="builder-pc-number-manual" placeholder="e.g., PC-000123" style="max-width: 200px;" onblur="window.app && window.app.builderValidatePcManual && window.app.builderValidatePcManual()" oninput="window.app && window.app.builderUpdatePcDropdown && window.app.builderUpdatePcDropdown()">
                            <select id="builder-pc-select" onchange="window.app && window.app.builderSelectPcFromDropdown && window.app.builderSelectPcFromDropdown()" style="min-width: 280px;">
                                <option value="">Select PC Number...</option>
                            </select>
                            <small id="builder-pc-hint" style="color:#6b7280;">No PC selected</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="price-list-selector">
                <h2>Step 2: Select Price List</h2>
                <label>Available Price Lists *</label>
                <select id="quote-price-list" onchange="window.app && window.app.handlePriceListChange && window.app.handlePriceListChange()"></select>
            </div>
            <div class="quote-builder" id="quote-items-section" style="display: none;">
                <div class="card">
                    <h2>Step 3: Build Quote</h2>
                    

                    
                    <!-- NEW Sprint 3.2: Bulk Operations Panel -->
                    <div id="bulk-operations-panel" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0 0 0.5rem 0; color: #92400e;">🔧 Bulk Operations</h4>
                                <p style="margin: 0; color: #92400e; font-size: 0.875rem;">
                                    <span id="bulk-selected-count">0</span> line items selected
                                </p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="window.bulkUpdateQuantity()" style="background: #3b82f6; color: white;">📊 Update Quantities</button>
                                <button onclick="window.bulkApplyDiscount()" style="background: #10b981; color: white;">💰 Apply Discount</button>
                                <button onclick="window.bulkDeleteItems()" style="background: #ef4444; color: white;">🗑️ Delete Selected</button>
                                <button onclick="window.clearBulkSelection()" class="secondary">Clear Selection</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Existing Category Sections -->
                    <div class="category-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Human Resources</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-size: 0.875rem; color: #666;">
                                    <input type="checkbox" onchange="window.toggleCategorySelection('human')" id="select-all-human"> Select All
                                </label>
                            </div>
                        </div>
                        <div id="quote-human"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="window.addLineItem('human')" class="secondary">+ Quick Add</button>
                        </div>
                    </div>
                    <div class="category-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Vehicles</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-size: 0.875rem; color: #666;">
                                    <input type="checkbox" onchange="window.toggleCategorySelection('vehicles')" id="select-all-vehicles"> Select All
                                </label>
                            </div>
                        </div>
                        <div id="quote-vehicles"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="window.addLineItem('vehicles')" class="secondary">+ Quick Add</button>
                        </div>
                    </div>
                    <div class="category-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Materials</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-size: 0.875rem; color: #666;">
                                    <input type="checkbox" onchange="window.toggleCategorySelection('materials')" id="select-all-materials"> Select All
                                </label>
                            </div>
                        </div>
                        <div id="quote-materials"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="window.addLineItem('materials')" class="secondary">+ Quick Add</button>
                        </div>
                    </div>
                     <div class="category-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Other</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="font-size: 0.875rem; color: #666;">
                                    <input type="checkbox" onchange="window.toggleCategorySelection('other')" id="select-all-other"> Select All
                                </label>
                            </div>
                        </div>
                        <div id="quote-other"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="window.addLineItem('other')" class="secondary">+ Quick Add</button>
                        </div>
                    </div>

                    <!-- Recycling Charges -->
                    <div class="category-section" style="margin-top: 1.5rem;">
                        <h3 style="margin: 0 0 0.75rem 0;">♻ Recycling Charges</h3>
                        <div style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items: end; margin-bottom: 0.5rem;">
                            <div>
                                <label>Type</label>
                                <select id="recycling-type">
                                    <option value="general">General Recycling</option>
                                    <option value="pops">POPS Recycling</option>
                                    <option value="weee">WEEE Recycling</option>
                                    <option value="other">Recycling Other</option>
                                </select>
                            </div>
                            <div>
                                <label>Mode</label>
                                <select id="recycling-mode" onchange="(function(s){
                                    const m=s.value; const byW=document.getElementById('recycling-byweight'); const man=document.getElementById('recycling-manual');
                                    if(m==='byWeight'){byW.style.display='flex'; man.style.display='none';} else {byW.style.display='none'; man.style.display='flex';}
                                })(this)">
                                    <option value="byWeight">By weight</option>
                                    <option value="manual">Manual amount</option>
                                </select>
                            </div>
                            <div id="recycling-byweight" style="display:flex; gap:0.5rem; align-items: end;">
                                <div>
                                    <label>Weight (kg)</label>
                                    <input id="recycling-weight" type="number" min="0" step="0.01" value="0">
                                </div>
                                <div>
                                    <label>Rate (£/tonne)</label>
                                    <input id="recycling-rate" type="number" min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div id="recycling-manual" style="display:none; gap:0.5rem; align-items: end;">
                                <div>
                                    <label>Amount (£)</label>
                                    <input id="recycling-amount" type="number" min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div>
                                <button class="secondary" onclick="window.app && window.app.addRecyclingItem && window.app.addRecyclingItem()">+ Add</button>
                            </div>
                        </div>
                        <table style="width:100%; border:1px solid #e5e7eb; border-radius:6px;">
                            <thead><tr><th style="width:40%">Type</th><th>Mode</th><th>Details</th><th>Amount</th><th></th></tr></thead>
                            <tbody id="recycling-table"></tbody>
                        </table>
                    </div>

                    <!-- Rebates -->
                    <div class="category-section" style="margin-top: 1.5rem;">
                        <h3 style="margin: 0 0 0.75rem 0;">💰 Rebates</h3>
                        <div style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items: end; margin-bottom: 0.5rem;">
                            <div>
                                <label>Type</label>
                                <select id="rebate-type" onchange="(function(s){
                                    const t=s.value; const mode=document.getElementById('rebate-mode-wrapper'); const desc=document.getElementById('rebate-desc-wrapper');
                                    if(t==='furniture'){mode.style.display='none'; desc.style.display='block';} else {mode.style.display='block'; desc.style.display='none';}
                                })(this)">
                                    <option value="furniture">Furniture Resale</option>
                                    <option value="it">IT Resale</option>
                                    <option value="metal">Metal</option>
                                    <option value="other">Rebate Other</option>
                                </select>
                            </div>
                            <div id="rebate-mode-wrapper">
                                <label>Mode</label>
                                <select id="rebate-mode" onchange="(function(s){
                                    const m=s.value; const byW=document.getElementById('rebate-byweight'); const man=document.getElementById('rebate-manual');
                                    if(m==='byWeight'){byW.style.display='flex'; man.style.display='none';} else {byW.style.display='none'; man.style.display='flex';}
                                })(this)">
                                    <option value="byWeight">By weight</option>
                                    <option value="manual" selected>Manual amount</option>
                                </select>
                            </div>
                            <div id="rebate-desc-wrapper" style="display:block;">
                                <label>Description</label>
                                <input id="rebate-desc" type="text" placeholder="Description for furniture resale">
                            </div>
                            <div id="rebate-byweight" style="display:none; gap:0.5rem; align-items: end;">
                                <div>
                                    <label>Weight (kg)</label>
                                    <input id="rebate-weight" type="number" min="0" step="0.01" value="0">
                                </div>
                                <div>
                                    <label>Rate (£/tonne)</label>
                                    <input id="rebate-rate" type="number" min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div id="rebate-manual" style="display:flex; gap:0.5rem; align-items: end;">
                                <div>
                                    <label>Amount (£)</label>
                                    <input id="rebate-amount" type="number" min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div>
                                <button class="secondary" onclick="window.app && window.app.addRebateItem && window.app.addRebateItem()">+ Add</button>
                            </div>
                        </div>
                        <table style="width:100%; border:1px solid #e5e7eb; border-radius:6px;">
                            <thead><tr><th style="width:40%">Type</th><th>Mode</th><th>Details</th><th>Amount</th><th></th></tr></thead>
                            <tbody id="rebates-table"></tbody>
                        </table>
                    </div>

                    <!-- Other Costs (Manual) -->
                    <div class="category-section" style="margin-top: 1.5rem;">
                        <h3 style="margin: 0 0 0.75rem 0;">📎 Other Costs (Manual)</h3>
                        <div style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items: end; margin-bottom: 0.5rem;">
                            <div>
                                <label>Description</label>
                                <input id="other-desc" type="text" placeholder="e.g., Special permit fee">
                            </div>
                            <div>
                                <label>Amount (£)</label>
                                <input id="other-amount" type="number" min="0" step="0.01" value="0">
                            </div>
                            <div>
                                <button class="secondary" onclick="window.app && window.app.addOtherCostManual && window.app.addOtherCostManual()">+ Add</button>
                            </div>
                        </div>
                        <table style="width:100%; border:1px solid #e5e7eb; border-radius:6px;">
                            <thead><tr><th style="width:60%">Description</th><th>Amount</th><th></th></tr></thead>
                            <tbody id="othercosts-table"></tbody>
                        </table>
                    </div>
                </div>
                <div class="summary">
                    <h3>Quote Summary</h3>
                    <div class="summary-line"><span>Human Resources:</span><span id="sum-human">£0.00</span></div>
                    <div class="summary-line"><span>Vehicles:</span><span id="sum-vehicles">£0.00</span></div>
                    <div class="summary-line"><span>Materials:</span><span id="sum-materials">£0.00</span></div>
                    <div class="summary-line"><span>Other:</span><span id="sum-other">£0.00</span></div>
                        <div class="summary-line"><span>Subtotal (PL):</span><span id="sum-subtotal">£0.00</span></div>
                        <div class="summary-line">
                            <span>Discount:</span>
                            <span>
                                <select id="quote-discount-type" onchange="window.app && window.app.recalcBuilderTotals && window.app.recalcBuilderTotals()" style="margin-right: 0.25rem;">
                                    <option value="percent">%</option>
                                    <option value="amount">£</option>
                                </select>
                                <input id="quote-discount-value" type="number" value="0" min="0" step="0.01" style="width: 90px;" oninput="window.app && window.app.recalcBuilderTotals && window.app.recalcBuilderTotals()" />
                                <span style="margin-left:0.5rem; color:#6b7280;">Only for PL items</span>
                            </span>
                        </div>
                        <div class="summary-line"><span>Discount Amount:</span><span id="sum-discount">£0.00</span></div>
                        <div class="summary-line"><span>Net After Discount:</span><span id="sum-net">£0.00</span></div>
                    <div class="summary-line"><span>Recycling:</span><span id="sum-recycling">£0.00</span></div>
                    <div class="summary-line"><span>Other Costs:</span><span id="sum-other-manual">£0.00</span></div>
                    <div class="summary-line"><span>Rebates:</span><span id="sum-rebates">£0.00</span></div>
                    <div class="summary-line">
                        <span>VAT Rate:</span>
                        <input type="number" id="quote-vat-rate" value="20.00" step="0.01" min="0" max="100" 
                               style="width: 60px; margin: 0; padding: 0.25rem;" onchange="window.app && window.app.recalcBuilderTotals && window.app.recalcBuilderTotals()">%
                    </div>
                    <div class="summary-line"><span>VAT Amount:</span><span id="sum-vat">£0.00</span></div>
                    <div class="summary-total"><span>Total (inc VAT):</span><span id="sum-total">£0.00</span></div>
                    
                    <!-- NEW: Move Type & Addresses Section -->
                    <div style="margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                        <h3 style="margin-bottom: 1rem;">📦 Move Type & Addresses</h3>
                        
                        <!-- Move Type Selection -->
                        <div style="margin-bottom: 1rem;">
                            <label>Move Type *</label>
                            <select id="quote-move-type" onchange="window.app && window.app.toggleAddressSections && window.app.toggleAddressSections()" required>
                                <option value="">Select move type...</option>
                                <option value="Collection Only">Collection Only</option>
                                <option value="Delivery Only">Delivery Only</option>
                                <option value="Collection + Delivery">Collection + Delivery</option>
                            </select>
                        </div>
                        
                        <!-- Collection Address Section -->
                        <div id="collection-section" style="display: none; margin-bottom: 1rem; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 0.5rem;">
                            <h4 style="margin-top: 0; margin-bottom: 1rem;">📍 Collection Address</h4>
                            <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
                                <div><label>Contact Name *</label><input type="text" id="quote-collection-name" placeholder="Contact person" required></div>
                                <div><label>Phone</label><input type="tel" id="quote-collection-phone" placeholder="Phone number" pattern="[0-9\s\+\-\(\)\.]+" title="Please enter a valid phone number"></div>
                                <div><label>Email</label><input type="email" id="quote-collection-email" placeholder="Email"></div>
                                <div><label>Date</label><input type="date" id="quote-collection-date"></div>
                            </div>
                            <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; margin-top: 0.75rem;">
                                <div><label>Address Line 1 *</label><input type="text" id="quote-collection-address1" placeholder="Street address" required></div>
                                <div><label>Address Line 2</label><input type="text" id="quote-collection-address2" placeholder="Additional info"></div>
                                <div><label>City *</label><input type="text" id="quote-collection-city" placeholder="City" required></div>
                                <div><label>County</label><input type="text" id="quote-collection-county" placeholder="County"></div>
                                <div><label>Postcode *</label><input type="text" id="quote-collection-postcode" placeholder="Postcode" required pattern="[A-Z]{1,2}[0-9]{1,2}[A-Z]?\s?[0-9][A-Z]{2}" title="Please enter a valid UK postcode (e.g., SW1A 1AA)"></div>
                            </div>
                        </div>
                        
                        <!-- Delivery Address Section -->
                        <div id="delivery-section" style="display: none; margin-bottom: 1rem; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 0.5rem;">
                            <h4 style="margin-top: 0; margin-bottom: 1rem;">🚚 Delivery Address</h4>
                            <div style="margin-bottom: 1rem;">
                                <label style="display: inline-flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="quote-same-address" onchange="window.app && window.app.copyCollectionToDelivery && window.app.copyCollectionToDelivery()" style="margin-right: 0.5rem;">
                                    Same as collection address
                                </label>
                            </div>
                            <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
                                <div><label>Contact Name *</label><input type="text" id="quote-delivery-name" placeholder="Contact person" required></div>
                                <div><label>Phone</label><input type="tel" id="quote-delivery-phone" placeholder="Phone number" pattern="[0-9\s\+\-\(\)\.]+" title="Please enter a valid phone number"></div>
                                <div><label>Email</label><input type="email" id="quote-delivery-email" placeholder="Email"></div>
                                <div><label>Date</label><input type="date" id="quote-delivery-date"></div>
                            </div>
                            <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; margin-top: 0.75rem;">
                                <div><label>Address Line 1 *</label><input type="text" id="quote-delivery-address1" placeholder="Street address" required></div>
                                <div><label>Address Line 2</label><input type="text" id="quote-delivery-address2" placeholder="Additional info"></div>
                                <div><label>City *</label><input type="text" id="quote-delivery-city" placeholder="City" required></div>
                                <div><label>County</label><input type="text" id="quote-delivery-county" placeholder="County"></div>
                                <div><label>Postcode *</label><input type="text" id="quote-delivery-postcode" placeholder="Postcode" required pattern="[A-Z]{1,2}[0-9]{1,2}[A-Z]?\s?[0-9][A-Z]{2}" title="Please enter a valid UK postcode (e.g., SW1A 1AA)"></div>
                            </div>
                        </div>
                        
                        <!-- Quoted Activities Section -->
                        <div style="margin-bottom: 1rem;">
                            <label>Quoted Activities (optional)</label>
                            <div id="quote-activities-multiselect" style="border: 1px solid #ccc; padding: 0.75rem; border-radius: 0.375rem; max-height: 120px; overflow-y: auto; background: white;">
                                <p style="margin: 0; color: #666; font-style: italic;">Loading activities for this PC...</p>
                            </div>
                            <p class="field-note">Select activities that are included in this quote pricing</p>
                        </div>
                    </div>
                    
                    <!-- Additional Quote Fields -->
                    <div style="margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                        <div style="margin-bottom: 1rem;">
                            <label>Quote Status *</label>
                            <select id="quote-status" onchange="window.handleQuoteStatusChange()" required>
                                <option value="DRAFT">DRAFT - Work in progress (editable)</option>
                                <option value="ISSUED">ISSUED - Sent to client (not editable)</option>
                                <option value="WON">WON - Quote accepted by client</option>
                                <option value="LOST">LOST - Quote lost to competitor</option>
                            </select>
                            <p class="field-note">Note: Once ISSUED, quote cannot be edited. WON/LOST are final states.</p>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Valid Until *</label>
                            <input type="date" id="quote-valid-until" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Quote Title *</label>
                            <input type="text" id="quote-title" placeholder="Brief quote description" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Description</label>
                            <textarea id="quote-description" rows="2" placeholder="Detailed quote description..."></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Internal Notes</label>
                            <textarea id="quote-notes" rows="2" placeholder="Internal notes (not visible to client)..."></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Terms & Conditions</label>
                            <textarea id="quote-terms" rows="3" placeholder="Payment terms, delivery conditions, etc...">Payment terms: 30 days net. All work carried out to current industry standards. Materials warranty as per manufacturer specifications.</textarea>
                        </div>
                    </div>
                    
                    <div class="form-actions" style="text-align: center; display:flex; gap:0.5rem; justify-content:center;">
                        <button onclick="window.app && window.app.saveQuoteFromBuilder ? window.app.saveQuoteFromBuilder() : window.saveQuote()">Save Draft</button>
                        <button style="background:#16a34a;" onclick="window.app && window.app.sendQuoteFromBuilder && window.app.sendQuoteFromBuilder()">Send to Customer</button>
                        <button onclick="window.saveQuoteAsTemplate()" style="background: #8b5cf6; color: white;">📄 Save as Template</button>
                        <button onclick="window.duplicateCurrentQuote()" style="background: #06b6d4; color: white;">📋 Duplicate Quote</button>
                        <button onclick="window.cancelQuote()" class="secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>





        <div id="activities" class="page">
            <h1>📋 Activities</h1>
            
            <!-- NEW Sprint 4.2: View Toggle and Controls -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button onclick="window.showActivityModal()" style="background: #3b82f6; color: white;">+ New Activity</button>
                    <div style="display: flex; background: #f1f5f9; border-radius: 0.5rem; padding: 0.25rem;">
                        <button id="activities-list-view-btn" onclick="window.switchActivitiesView('list')" 
                                style="padding: 0.5rem 1rem; border: none; background: #3b82f6; color: white; border-radius: 0.25rem;">
                            📋 List View
                        </button>
                        <button id="activities-calendar-view-btn" onclick="window.switchActivitiesView('calendar')" 
                                style="padding: 0.5rem 1rem; border: none; background: transparent; color: #374151; border-radius: 0.25rem;">
                            📅 Calendar View
                        </button>

                    </div>
                </div>
                
                <!-- Calendar Navigation (hidden by default) -->
                <div id="calendar-navigation" style="display: none; align-items: center; gap: 1rem;">
                    <div style="display: flex; background: #f1f5f9; border-radius: 0.5rem; padding: 0.25rem;">
                        <button id="calendar-month-btn" onclick="window.setCalendarView('month')" 
                                style="padding: 0.5rem 1rem; border: none; background: #3b82f6; color: white; border-radius: 0.25rem;">
                            Month
                        </button>
                        <button id="calendar-week-btn" onclick="window.setCalendarView('week')" 
                                style="padding: 0.5rem 1rem; border: none; background: transparent; color: #374151; border-radius: 0.25rem;">
                            Week
                        </button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <button onclick="window.navigateCalendar('prev')" style="padding: 0.25rem 0.5rem; background: #e5e7eb;">‹</button>
                        <span id="calendar-title" style="min-width: 200px; text-align: center; font-weight: 500;">October 2024</span>
                        <button onclick="window.navigateCalendar('next')" style="padding: 0.25rem 0.5rem; background: #e5e7eb;">›</button>
                        <button onclick="window.navigateCalendar('today')" style="padding: 0.25rem 0.5rem; background: #3b82f6; color: white;">Today</button>
                    </div>
                </div>
            </div>
            
            <!-- Smart Filter for Activities -->
            <div class="card" style="margin-bottom: 1rem;">
                <h3 style="margin-bottom: 0.75rem;">🔍 Smart Filter</h3>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <label for="activity-filter-company" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Company Name:</label>
                        <input 
                            type="text" 
                            id="activity-filter-company" 
                            placeholder="Start typing company name..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterActivitiesByCompany(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <label for="activity-filter-account-manager" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Account Manager:</label>
                        <input 
                            type="text" 
                            id="activity-filter-account-manager" 
                            placeholder="Start typing account manager..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterActivitiesByAccountManager(this.value)"
                        >
                    </div>
                    <div style="flex: 1; min-width: 200px;">
                        <label for="activity-filter-pc-number" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">PC Number:</label>
                        <input 
                            type="text" 
                            id="activity-filter-pc-number" 
                            placeholder="Start typing PC number..." 
                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
                            oninput="window.filterActivitiesByPcNumber(this.value)"
                        >
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button onclick="window.clearActivityFilter()" class="secondary">Clear Filter</button>
                    </div>
                </div>
                <div id="activity-filter-results" style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;"></div>
            </div>
            
            <!-- List View (default) -->
            <div id="activities-list-view" class="card">
                <h2>Activity List</h2>
                <table>
                    <thead><tr>
                        <th class="sortable" data-sort="title">Title ↕</th>
                        <th class="sortable" data-sort="pcNumber">PC Number ↕</th>
                        <th class="sortable" data-sort="company">Company ↕</th>
                        <th class="sortable" data-sort="type">Type ↕</th>
                        <th class="sortable" data-sort="scheduledDate">Scheduled ↕</th>
                        <th class="sortable" data-sort="priority">Priority ↕</th>
                        <th class="sortable" data-sort="status">Status ↕</th>
                        <th class="sortable" data-sort="accountManager">Account Manager ↕</th>
                        <th class="sortable" data-sort="lastModifiedAt">Date Modified ↕</th>
                        <th>Actions</th>
                    </tr></thead>
                    <tbody id="activities-list"></tbody>
                </table>
            </div>
            
            <!-- NEW Sprint 4.2: Calendar View -->
            <div id="activities-calendar-view" style="display: none;">
                <!-- Month View Calendar -->
                <div id="calendar-month-view" class="card">
                    <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e5e7eb;">
                        <!-- Calendar grid will be generated by JavaScript -->
                    </div>
                </div>
                
                <!-- Week View Calendar -->
                <div id="calendar-week-view" class="card" style="display: none;">
                    <div style="display: grid; grid-template-columns: 100px repeat(7, 1fr); gap: 1px; background: #e5e7eb;">
                        <!-- Week view grid will be generated by JavaScript -->
                        <div style="background: white; padding: 0.5rem; font-weight: 500;"></div>
                        <!-- Time slots and days -->
                        <div id="week-grid-content">
                            <!-- Generated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Activity Details Sidebar (for calendar view) -->
                <div id="calendar-activity-sidebar" style="display: none; position: fixed; right: 20px; top: 20px; width: 300px; background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 1000;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">Activity Details</h3>
                        <button onclick="window.closeCalendarSidebar()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
                    </div>
                    <div id="calendar-activity-content">
                        <!-- Activity details will be populated here -->
                    </div>
                </div>

                <!-- NEW Sprint 4.2.2: Quick Create Activity Overlay -->
                <div id="quick-create-overlay" class="quick-create-overlay">
                    <div class="quick-create-form">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Quick Create Activity</h3>
                            <button onclick="window.closeQuickCreate()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
                        </div>
                        
                        <div id="quick-create-time-info" class="time-slot-info">
                            <!-- Time slot info will be populated here -->
                        </div>

                        <form id="quick-create-form" onsubmit="window.submitQuickCreate(event)">
                            <div style="margin-bottom: 1rem;">
                                <label for="quick-activity-title" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Activity Title *</label>
                                <input type="text" id="quick-activity-title" name="title" required 
                                       style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label for="quick-activity-pc" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">PC Number</label>
                                <select id="quick-activity-pc" name="pc_id" 
                                        style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    <option value="">Select PC Number</option>
                                    <!-- PC options will be populated -->
                                </select>
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label for="quick-activity-assignee" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Assign To</label>
                                <select id="quick-activity-assignee" name="assigned_to" 
                                        style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    <option value="">Unassigned</option>
                                    <!-- Team members will be populated -->
                                </select>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                                <div>
                                    <label for="quick-activity-priority" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Priority</label>
                                    <select id="quick-activity-priority" name="priority" 
                                            style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                        <option value="normal">Normal</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="quick-activity-duration" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Duration (hrs)</label>
                                    <input type="number" id="quick-activity-duration" name="estimated_hours" min="0.25" step="0.25" value="1"
                                           style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                </div>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label for="quick-activity-description" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Description</label>
                                <textarea id="quick-activity-description" name="description" rows="3"
                                          style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; resize: vertical;"></textarea>
                            </div>

                            <!-- NEW Sprint 4.2.4: Recurring Activities Section -->
                            <div class="recurring-section">
                                <div class="recurring-toggle">
                                    <input type="checkbox" id="quick-recurring-enabled" name="recurring_enabled" onchange="window.toggleRecurringOptions(this)">
                                    <label for="quick-recurring-enabled" style="font-weight: 500; color: #374151;">🔄 Make this a recurring activity</label>
                                </div>
                                
                                <div id="quick-recurring-options" class="recurring-options">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Repeat</label>
                                        <select id="quick-recurring-frequency" name="recurring_frequency" 
                                                style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                            <option value="daily">Daily</option>
                                            <option value="weekly" selected>Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="yearly">Yearly</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Every</label>
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <input type="number" id="quick-recurring-interval" name="recurring_interval" min="1" max="365" value="1" 
                                                   style="width: 60px; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                            <span id="quick-recurring-unit" style="font-size: 0.875rem; color: #6b7280;">week(s)</span>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">End Date</label>
                                        <input type="date" id="quick-recurring-end-date" name="recurring_end_date" 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                    </div>
                                    
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Or Max Occurrences</label>
                                        <input type="number" id="quick-recurring-count" name="recurring_count" min="1" max="365" placeholder="e.g., 10" 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                    </div>
                                </div>
                                
                                <div id="quick-recurring-preview" class="recurring-preview" style="display: none;">
                                    <!-- Preview will be generated here -->
                                </div>
                            </div>

                            <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                                <button type="button" onclick="window.closeQuickCreate()" 
                                        style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        style="background: #3b82f6; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                    Create Activity
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- NEW Sprint 4.2.3: Team Management Modal -->
                <div id="team-management-modal" class="quick-create-overlay" style="display: none;">
                    <div class="quick-create-form" style="width: 500px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">👥 Team Management</h3>
                            <button onclick="window.closeTeamManagement()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
                        </div>
                        
                        <!-- Add New Team Member Form -->
                        <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 1rem 0; font-size: 1rem; font-weight: 600;">Add Team Member</h4>
                            <form id="add-team-member-form" onsubmit="window.addTeamMember(event)">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Name *</label>
                                        <input type="text" name="name" required 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Role</label>
                                        <input type="text" name="role" placeholder="e.g., Engineer, Manager" 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                                        <input type="email" name="email" 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Max Hours/Week</label>
                                        <input type="number" name="max_hours" min="1" max="60" value="40" 
                                               style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                                    </div>
                                </div>
                                <button type="submit" 
                                        style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                    ➕ Add Member
                                </button>
                            </form>
                        </div>
                        
                        <!-- Current Team Members -->
                        <div>
                            <h4 style="margin: 0 0 1rem 0; font-size: 1rem; font-weight: 600;">Current Team</h4>
                            <div id="team-members-list" style="max-height: 300px; overflow-y: auto;">
                                <!-- Team members will be listed here -->
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
                            <button onclick="window.closeTeamManagement()" 
                                    style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- NEW Sprint 4.2.4: Recurring Activity Edit Modal -->
                <div id="recurring-edit-modal" class="quick-create-overlay" style="display: none;">
                    <div class="quick-create-form" style="width: 450px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">🔄 Edit Recurring Activity</h3>
                            <button onclick="window.closeRecurringEditModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
                        </div>
                        
                        <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.875rem; color: #92400e;">
                                <strong>⚠️ This is part of a recurring series.</strong><br>
                                Choose how you want to apply your changes:
                            </p>
                        </div>
                        
                        <div id="recurring-edit-options" class="recurring-series-buttons" style="margin-bottom: 1.5rem;">
                            <button onclick="window.editRecurringActivity('single')" 
                                    style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; flex: 1;">
                                📝 Edit Only This Activity
                            </button>
                            <button onclick="window.editRecurringActivity('future')" 
                                    style="background: #f59e0b; color: white; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; flex: 1;">
                                📅 Edit This & Future Activities
                            </button>
                            <button onclick="window.editRecurringActivity('all')" 
                                    style="background: #10b981; color: white; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; flex: 1;">
                                🔄 Edit Entire Series
                            </button>
                        </div>
                        
                        <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 1rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: #0c4a6e; font-size: 0.875rem; font-weight: 600;">Activity Details:</h4>
                            <div id="recurring-activity-details" style="font-size: 0.875rem; color: #0c4a6e;">
                                <!-- Activity details will be populated here -->
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                            <button onclick="window.closeRecurringEditModal()" 
                                    style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                Cancel
                            </button>
                            <button onclick="window.deleteRecurringSeries()" 
                                    style="background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer;">
                                🗑️ Delete Series
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div id="activity-detail" class="page">
            <h1 id="activity-detail-title">Activity Details</h1>
            
            <!-- Main Activity Data -->
            <div class="card">
                <h2>Activity Information</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div><strong>Title:</strong> <span id="activity-detail-title-text"></span></div>
                    <div><strong>Type:</strong> <span id="activity-detail-type"></span></div>
                    <div><strong>PC Number:</strong> <span id="activity-detail-pc-number"></span></div>
                    <div><strong>Status:</strong> <span id="activity-detail-status"></span></div>
                    <div><strong>Priority:</strong> <span id="activity-detail-priority"></span></div>
                    <div><strong>Assigned To:</strong> <span id="activity-detail-assigned-to"></span></div>
                    <div><strong>Scheduled Date:</strong> <span id="activity-detail-scheduled-date"></span></div>
                    <div><strong>Scheduled Time:</strong> <span id="activity-detail-scheduled-time"></span></div>
                    <div><strong>Duration:</strong> <span id="activity-detail-duration"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Description:</strong><br>
                    <span id="activity-detail-description" style="white-space: pre-wrap;"></span>
                </div>
                <div class="form-actions">
                    <button onclick="window.editActivity(window.currentActivity.id)" class="warning">Edit Activity</button>
                    <button onclick="window.showActivityModal()" class="primary">Add New Activity</button>
                    <button data-show-page="activities" class="secondary">Back to Activities</button>
                </div>
            </div>
            
            <!-- Location & Contact Information -->
            <div class="card">
                <h2>Location & Contact</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div><strong>Location:</strong> <span id="activity-detail-location"></span></div>
                    <div><strong>Contact Name:</strong> <span id="activity-detail-contact-name"></span></div>
                    <div><strong>Contact Phone:</strong> <span id="activity-detail-contact-phone"></span></div>
                </div>
            </div>

            <!-- Management & Timing Information -->
            <div class="card">
                <h2>Management & Timing</h2>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div><strong>Department:</strong> <span id="activity-detail-department"></span></div>
                    <div><strong>Payment Type:</strong> <span id="activity-detail-payment-type"></span></div>
                    <div><strong>Activity Number:</strong> <span id="activity-detail-activity-number"></span></div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div><strong>Depot Start:</strong> <span id="activity-detail-time-depot-start"></span></div>
                    <div><strong>Site Start:</strong> <span id="activity-detail-time-site-start"></span></div>
                    <div><strong>Site Finish:</strong> <span id="activity-detail-time-site-finish"></span></div>
                    <div><strong>Depot Finish:</strong> <span id="activity-detail-time-depot-finish"></span></div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div><strong>Total Hours:</strong> <span id="activity-detail-hours"></span></div>
                    <div><strong>Moveman Job:</strong> <span id="activity-detail-moveman-job"></span></div>
                    <div><strong>CRM ID:</strong> <span id="activity-detail-crm-id"></span></div>
                </div>
            </div>

            <!-- Professional Details -->
            <div class="card" id="activity-detail-instructions-card" style="display: none;">
                <h2>Professional Details</h2>
                <div>
                    <strong>Instructions:</strong><br>
                    <span id="activity-detail-instructions" style="white-space: pre-wrap;"></span>
                </div>
            </div>

            <!-- Logistics & Requirements -->
            <div class="card">
                <h2>Logistics & Requirements</h2>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div><strong>Parking Required:</strong> <span id="activity-detail-parking-required"></span></div>
                    <div><strong>Confirmed:</strong> <span id="activity-detail-confirmed"></span></div>
                    <div><strong>Risk Assessment Needed:</strong> <span id="activity-detail-risk-assessment-needed"></span></div>
                </div>
            </div>

            <!-- Collection Address -->
            <div class="card" id="activity-detail-collection-card" style="display: none;">
                <h2>Collection Address</h2>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div><strong>Contact:</strong> <span id="activity-detail-collection-contact"></span></div>
                    <div><strong>Phone:</strong> <span id="activity-detail-collection-phone"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Address:</strong><br>
                    <span id="activity-detail-collection-address"></span>
                </div>
            </div>

            <!-- Delivery Address -->
            <div class="card" id="activity-detail-delivery-card" style="display: none;">
                <h2>Delivery Address</h2>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div><strong>Contact:</strong> <span id="activity-detail-delivery-contact"></span></div>
                    <div><strong>Phone:</strong> <span id="activity-detail-delivery-phone"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Address:</strong><br>
                    <span id="activity-detail-delivery-address"></span>
                </div>
            </div>

            <!-- Completion Notes (if completed) -->
            <div class="card" id="activity-detail-completion-card" style="display: none;">
                <h2>Completion Details</h2>
                <div>
                    <strong>Completion Notes:</strong><br>
                    <span id="activity-detail-completion-notes" style="white-space: pre-wrap;"></span>
                </div>
            </div>
        </div>

        <div id="quote-detail" class="page">
            <h1 id="quote-detail-title">Quote Details</h1>
            
            <!-- Main Quote Data -->
            <div class="card">
                <h2>Quote Information</h2>
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div><strong>Quote Number:</strong> <span id="quote-detail-number"></span></div>
                    <div><strong>PC Number:</strong> <span id="quote-detail-pc-number"></span></div>
                    <div><strong>Client Name:</strong> <span id="quote-detail-client-name"></span></div>
                    <div><strong>Project Title:</strong> <span id="quote-detail-project-title"></span></div>
                    <div><strong>Account Manager:</strong> <span id="quote-detail-account-manager"></span></div>
                    <div><strong>Value:</strong> <span id="quote-detail-value"></span></div>
                    <div><strong>Status:</strong> <span id="quote-detail-status"></span></div>
                    <div><strong>Valid Until:</strong> <span id="quote-detail-valid-until"></span></div>
                    <div><strong>Created:</strong> <span id="quote-detail-created-at"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Description:</strong><br>
                    <span id="quote-detail-description" style="white-space: pre-wrap;"></span>
                </div>
                <div class="form-actions">
                    <button onclick="window.editQuote(window.currentQuote.id)" class="warning">Edit Quote</button>
                    <button onclick="window.showNewQuoteModal()" class="primary">Create New Quote</button>
                    <button data-show-page="quotes" class="secondary">Back to Quotes</button>
                </div>
            </div>

            <!-- Financial Details -->
            <div class="card">
                <h2>Financial Details</h2>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div><strong>Version:</strong> <span id="quote-detail-version"></span></div>
                    <div><strong>Net Total:</strong> <span id="quote-detail-net-total"></span></div>
                    <div><strong>VAT Rate:</strong> <span id="quote-detail-vat-rate"></span></div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div><strong>VAT Amount:</strong> <span id="quote-detail-vat-amount"></span></div>
                    <div><strong>Discount:</strong> <span id="quote-detail-discount"></span></div>
                    <div><strong>Total Cost:</strong> <span id="quote-detail-total-cost"></span></div>
                </div>
            </div>

            <!-- Professional Details -->
            <div class="card">
                <h2>Professional Details</h2>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div><strong>Standard Liability:</strong> <span id="quote-detail-standard-liability"></span></div>
                    <div><strong>Declared Value:</strong> <span id="quote-detail-declared-value"></span></div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>Price List:</strong> <span id="quote-detail-price-list"></span>
                </div>
            </div>

            <!-- Pricing Breakdown -->
            <div class="card">
                <h2>Pricing Breakdown</h2>
                
                <!-- Quote Items -->
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 0.75rem 0; color: #374151;">Quote Items</h3>
                    <div id="quote-detail-items" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 0.75rem; min-height: 60px;">
                        <div style="text-align: center; color: #6b7280; font-size: 0.875rem;">
                            No items in this quote
                        </div>
                    </div>
                </div>

                <!-- Additional Costs -->
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <strong>Recycling Charges:</strong>
                        <div style="margin-left: 1rem; margin-top: 0.5rem;">
                            <div>Recycling Fee: <span id="quote-detail-recycling-fee"></span></div>
                            <div>Environmental Fee: <span id="quote-detail-environmental-fee"></span></div>
                        </div>
                    </div>
                    <div>
                        <strong>Rebates:</strong>
                        <div style="margin-left: 1rem; margin-top: 0.5rem;">
                            <div>Volume Rebate: <span id="quote-detail-volume-rebate"></span></div>
                            <div>Loyalty Rebate: <span id="quote-detail-loyalty-rebate"></span></div>
                        </div>
                    </div>
                </div>

                <!-- Other Costs -->
                <div id="quote-detail-other-costs-section" style="display: none;">
                    <h4 style="margin: 0 0 0.75rem 0; color: #374151;">Other Costs</h4>
                    <div id="quote-detail-other-costs" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 0.75rem;">
                        <!-- Other costs will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="resources" class="page">
            <h1>🔧 Resources</h1>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                <button onclick="window.showResourceModal()">+ New Resource</button>
            </div>
            <div class="card">
                <h2>Resource Database</h2>
                <table>
                    <thead><tr><th>Name</th><th>Category</th><th>Net Cost</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="resources-list"></tbody>
                </table>
            </div>
        </div>

        <div id="pricelists" class="page">
             <h1>🏷️ Price Lists</h1>
            <button data-show-page="new-pricelist">+ New Price List</button>
            <div class="card">
                <h2>Available Price Lists</h2>
                <table>
                    <thead><tr>
                        <th class="sortable" data-sort="name">Name ↕</th>
                        <th class="sortable" data-sort="version">Version ↕</th>
                        <th class="sortable" data-sort="currency">Currency ↕</th>
                        <th class="sortable" data-sort="effectivePeriod">Effective Period ↕</th>
                        <th class="sortable" data-sort="isDefault">Default ↕</th>
                        <th class="sortable" data-sort="status">Status ↕</th>
                        <th class="sortable" data-sort="lastModifiedAt">Date Modified ↕</th>
                        <th>Actions</th>
                    </tr></thead>
                    <tbody id="pricelist-table"></tbody>
                </table>
            </div>
        </div>

        <div id="new-pricelist" class="page">
            <h1 id="pricelist-form-title">New Price List</h1>
            <div class="card">
                <input type="hidden" id="pricelist-id">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-grid">
                        <div><label>Price List Name *</label><input type="text" id="pricelist-name" placeholder="e.g. Standard Commercial Rates 2024" required></div>
                        <div><label>Version *</label><input type="text" id="pricelist-version" placeholder="e.g. v2.1" required></div>
                        <div><label>Currency</label><select id="pricelist-currency">
                            <option value="GBP" selected>GBP (£)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                        </select></div>
                        <div><label>Status</label><select id="pricelist-status">
                            <option value="draft">Draft</option>
                            <option value="active" selected>Active</option>
                            <option value="inactive">Inactive</option>
                        </select></div>
                    </div>
                    <div>
                        <label>Description</label>
                        <textarea id="pricelist-description" rows="2" placeholder="Brief description of this price list..."></textarea>
                    </div>
                </div>
                
                <!-- Pricing Configuration -->
                <div class="form-section">
                    <h3>Pricing Configuration</h3>
                    <div class="form-grid">
                        <div><label>Default Markup (%) *</label><input type="number" id="pricelist-markup" step="0.01" min="0" placeholder="35.00" required></div>
                        <div><label>Discount (%)</label><input type="number" id="pricelist-discount" step="0.01" min="0" max="100" placeholder="0.00"></div>
                        <div><label>Effective From *</label><input type="date" id="pricelist-effective-from" required></div>
                        <div><label>Effective Until</label><input type="date" id="pricelist-effective-to"></div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <label style="display: inline-flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="pricelist-is-default" style="margin-right: 0.5rem;">
                            Set as default price list
                        </label>
                    </div>
                </div>
                
                <!-- Terms & Conditions -->
                <div class="form-section">
                    <h3>Terms & Conditions</h3>
                    <div>
                        <label>Default Terms</label>
                        <textarea id="pricelist-terms" rows="3" placeholder="Pricing terms, payment conditions, delivery notes...">Prices valid for 30 days from quote date. Payment terms: 30 days net. Delivery charges may apply.</textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button onclick="window.createPriceList()">Create Price List</button>
                    <button data-show-page="pricelists" class="secondary">Cancel</button>
                </div>
            </div>
        </div>

        <div id="pricelist-detail" class="page">
            <h1 id="pricelist-title">Price List Details</h1>
             <div class="card">
                <button onclick="window.showAddResourceToPriceList()">+ Add Item to Price List</button>
                <button data-show-page="pricelists" class="secondary">Back to list</button>
            </div>
            <div class="card">
                <h2>Price List Items</h2>
                <table>
                    <thead><tr><th>Resource</th><th>Net Cost</th><th>Client Price</th><th>Margin %</th><th>Actions</th></tr></thead>
                    <tbody id="pricelist-items"></tbody>
                </table>
            </div>
        </div>








        <!-- Price List Item Detail Page -->
        <div id="pricelist-item-detail" class="page">
            <h1 id="pricelist-item-title">Price List Item Details</h1>
            
            <div class="card">
                <button onclick="window.editCurrentPriceListItem()" class="button primary">✏️ Edit Item</button>
                <button onclick="window.deleteCurrentPriceListItem()" class="button danger">🗑️ Delete Item</button>
                <button onclick="window.backToPriceListDetail()" class="button secondary">← Back to Price List</button>
            </div>

            <!-- Item Information -->
            <div class="card">
                <h2>Item Information</h2>
                <div class="detail-grid">
                    <div>
                        <label>Description:</label>
                        <span id="pricelist-item-detail-description">-</span>
                    </div>
                    <div>
                        <label>Category:</label>
                        <span id="pricelist-item-detail-category">-</span>
                    </div>
                    <div>
                        <label>Unit:</label>
                        <span id="pricelist-item-detail-unit">-</span>
                    </div>
                </div>
            </div>

            <!-- Pricing Information -->
            <div class="card">
                <h2>Pricing Details</h2>
                <div class="detail-grid">
                    <div>
                        <label>Net Cost:</label>
                        <span id="pricelist-item-detail-price" style="font-weight: 600; color: #059669;">-</span>
                    </div>
                    <div>
                        <label>Margin:</label>
                        <span id="pricelist-item-detail-margin">-</span>
                    </div>
                    <div>
                        <label>Client Price:</label>
                        <span id="pricelist-item-detail-client-price" style="font-weight: 600; color: #dc2626;">-</span>
                    </div>
                    <div>
                        <label>Profit per Unit:</label>
                        <span id="pricelist-item-detail-profit" style="font-weight: 600; color: #0891b2;">-</span>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="card" id="pricelist-item-notes-card" style="display: none;">
                <h2>Notes</h2>
                <div style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; border-left: 4px solid #3b82f6;">
                    <span id="pricelist-item-detail-notes">-</span>
                </div>
            </div>

            <!-- Price List Context -->
            <div class="card">
                <h2>Price List Information</h2>
                <div class="detail-grid">
                    <div>
                        <label>Price List:</label>
                        <span id="pricelist-item-detail-pricelist-name">-</span>
                    </div>
                    <div>
                        <label>Region:</label>
                        <span id="pricelist-item-detail-pricelist-region">-</span>
                    </div>
                    <div>
                        <label>Currency:</label>
                        <span id="pricelist-item-detail-pricelist-currency">-</span>
                    </div>
                    <div>
                        <label>Status:</label>
                        <span id="pricelist-item-detail-pricelist-status">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <h1>⚙️ System Settings</h1>
            
            <!-- Data Management Section -->
            <div class="card">
                <h2>📊 Data Management</h2>
                <p>Export and import your CRM data in JSON format. This includes all PC Numbers, Quotes, Activities, Price Lists, and Resources.</p>
                
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                    <!-- Export Data -->
                    <div style="flex: 1; min-width: 300px;">
                        <h3 style="margin: 0 0 1rem 0; color: #059669;">📤 Export Data</h3>
                        <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Download all your data as a JSON file for backup or transfer.</p>
                        <button onclick="window.exportData()" class="button primary" style="width: 100%;">
                            💾 Export All Data
                        </button>
                    </div>
                    
                    <!-- Import Data -->
                    <div style="flex: 1; min-width: 300px;">
                        <h3 style="margin: 0 0 1rem 0; color: #dc2626;">📥 Import Data</h3>
                        <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem;">Upload a JSON file to restore or import data. <strong>Warning:</strong> This will replace all existing data.</p>
                        <input type="file" id="import-file" accept=".json" style="margin-bottom: 1rem; width: 100%; padding: 0.5rem; border: 2px dashed #d1d5db; border-radius: 0.5rem;">
                        <button onclick="window.importData()" class="button danger" style="width: 100%;" id="import-button" disabled>
                            🔄 Import Data
                        </button>
                    </div>
                </div>
                
                <!-- Warning Notice -->
                <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem; margin-top: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.25rem;">⚠️</span>
                        <div>
                            <strong style="color: #92400e;">Important Notice</strong>
                            <p style="margin: 0.25rem 0 0 0; color: #92400e; font-size: 0.875rem;">
                                Always export your data before importing new data. Import operations will permanently replace all existing data and cannot be undone.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Information -->
            <div class="card">
                <h2>ℹ️ System Information</h2>
                <div class="detail-grid">
                    <div>
                        <label>Current User:</label>
                        <span id="settings-current-user">-</span>
                    </div>
                    <div>
                        <label>Total PC Numbers:</label>
                        <span id="settings-pc-count">-</span>
                    </div>
                    <div>
                        <label>Total Quotes:</label>
                        <span id="settings-quotes-count">-</span>
                    </div>
                    <div>
                        <label>Total Activities:</label>
                        <span id="settings-activities-count">-</span>
                    </div>
                    <div>
                        <label>Total Price Lists:</label>
                        <span id="settings-pricelists-count">-</span>
                    </div>
                    <div>
                        <label>Total Resources:</label>
                        <span id="settings-resources-count">-</span>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div id="quote-modal" class="modal"><div class="modal-content" style="max-width: 600px;">
        <h2>Create New Quote</h2>
        
        <form id="new-quote-form">
            <!-- PC Number -->
            <div class="form-section">
                <h3>PC Number</h3>
                <div>
                    <label>PC Number *</label>
                    <select id="quote-modal-pc" required>
                        <option value="">Select PC Number...</option>
                    </select>
                    <small id="pc-select-help" style="color: #6b7280;">Choose the project for this quote</small>
                    <small id="pc-select-locked" style="color: #059669; display: none;">✓ PC Number automatically selected from source project</small>
                </div>
            </div>

            <!-- Account Manager -->
            <div class="form-section" id="quote-modal-account-manager-section">
                <h3>Account Manager</h3>
                <div>
                    <label>Account Manager *</label>
                    <select id="quote-modal-account-manager" required>
                        <option value="">Select Account Manager...</option>
                        <option value="John Smith">John Smith</option>
                        <option value="Sarah Johnson">Sarah Johnson</option>
                        <option value="Mike Wilson">Mike Wilson</option>
                        <option value="Emma Brown">Emma Brown</option>
                        <option value="David Lee">David Lee</option>
                    </select>
                    <small style="color: #6b7280;">Choose the account manager for this quote</small>
                </div>
            </div>

            <!-- Property Type -->
            <div class="form-section">
                <h3>Property Type</h3>
                <div>
                    <label>Property Type</label>
                    <select id="quote-modal-property-type">
                        <option value="">Select Property Type...</option>
                        <option>Office with IT equipment</option>
                        <option>Office without IT equipment</option>
                        <option>Museum</option>
                        <option>Warehouse</option>
                        <option>Laboratory</option>
                        <option>Domestic - Individual</option>
                        <option>Library</option>
                        <option>Gallery</option>
                    </select>
                </div>
            </div>

            <!-- Price List -->
            <div class="form-section">
                <h3>Price List</h3>
                <div>
                    <label>Price List *</label>
                    <select id="quote-modal-pricelist" required>
                        <option value="">Select Price List...</option>
                    </select>
                    <small style="color: #6b7280;">Choose the pricing structure for this quote</small>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="primary">Create Quote</button>
                <button type="button" onclick="window.closeQuoteModal()" class="secondary">Cancel</button>
            </div>
        </form>
    </div></div>

    <!-- Quote Edit Modal -->
    <div id="quote-edit-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2 id="quote-edit-modal-title">Edit Quote</h2>
            <form id="quote-edit-form">
                <input type="hidden" id="quote-edit-id">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-grid">
                        <div>
                            <label>Quote Number *</label>
                            <input type="text" id="quote-edit-number" required placeholder="QT-2024-001" readonly>
                        </div>
                        <div>
                            <label>Status *</label>
                            <select id="quote-edit-status" required>
                                <option value="draft">Draft</option>
                                <option value="pending">Send to Customer, awaiting approval</option>
                                <option value="approved">Approved</option>
                                <option value="declined">Declined</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div>
                            <label>PC Number *</label>
                            <input type="text" id="quote-edit-pc-number" required placeholder="PC-2024-001">
                        </div>
                        <div>
                            <label>Value (£) *</label>
                            <input type="number" id="quote-edit-value" required min="0" step="0.01" placeholder="0.00">
                            <small class="field-note">Bulk value: use only when individual quote line details are not provided.</small>
                        </div>
                    </div>
                </div>

                <!-- Client & Project -->
                <div class="form-section">
                    <h3>Client & Project</h3>
                    <div>
                        <label>Client Name *</label>
                        <input type="text" id="quote-edit-client-name" required placeholder="Client company name">
                    </div>
                    <div>
                        <label>Project Title *</label>
                        <input type="text" id="quote-edit-project-title" required placeholder="Project title">
                    </div>
                    <div>
                        <label>Property Type</label>
                        <select id="quote-edit-property-type">
                            <option value="">Select Property Type...</option>
                            <option>Office with IT equipment</option>
                            <option>Office without IT equipment</option>
                            <option>Museum</option>
                            <option>Warehouse</option>
                            <option>Laboratory</option>
                            <option>Domestic - Individual</option>
                            <option>Library</option>
                            <option>Gallery</option>
                        </select>
                    </div>
                    <div class="form-grid">
                        <div>
                            <label>Valid Until</label>
                            <input type="date" id="quote-edit-valid-until">
                        </div>
                        <div>
                            <label>Account Manager *</label>
                            <select id="quote-edit-account-manager" required>
                                <option value="">Select Account Manager...</option>
                                <option value="John Smith">John Smith</option>
                                <option value="Sarah Johnson">Sarah Johnson</option>
                                <option value="Mike Wilson">Mike Wilson</option>
                                <option value="Emma Brown">Emma Brown</option>
                                <option value="David Lee">David Lee</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Financial Details -->
                <div class="form-section">
                    <h3>Financial Details</h3>
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div>
                            <label>Version</label>
                            <input type="number" id="quote-edit-version" min="1" value="1" placeholder="1">
                            <small>Version number for tracking revisions</small>
                        </div>
                        <div>
                            <label>Net Total (£)</label>
                            <input type="number" id="quote-edit-net-total" min="0" step="0.01" placeholder="0.00">
                            <small>Total before VAT and discount</small>
                        </div>
                        <div>
                            <label>VAT Rate (%)</label>
                            <input type="number" id="quote-edit-vat-rate" min="0" max="100" step="0.01" value="20.00" placeholder="20.00">
                            <small>Standard UK VAT rate</small>
                        </div>
                    </div>
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 1rem;">
                        <div>
                            <label>VAT Amount (£)</label>
                            <input type="number" id="quote-edit-vat-amount" min="0" step="0.01" placeholder="0.00" readonly>
                            <small>Calculated automatically</small>
                        </div>
                        <div>
                            <label>Discount (£)</label>
                            <input type="number" id="quote-edit-discount" min="0" step="0.01" placeholder="0.00">
                            <small>Total discount amount</small>
                        </div>
                        <div>
                            <label>Total Cost (£)</label>
                            <input type="number" id="quote-edit-total-cost" min="0" step="0.01" placeholder="0.00" readonly>
                            <small>Final total after VAT and discount</small>
                        </div>
                    </div>
                </div>

                <!-- Professional Details -->
                <div class="form-section">
                    <h3>Professional Details</h3>
                    <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div>
                            <label>Standard Liability (£)</label>
                            <input type="number" id="quote-edit-standard-liability" min="0" step="0.01" value="100000.00" placeholder="100000.00">
                            <small>Standard liability coverage</small>
                        </div>
                        <div>
                            <label>Declared Value (£)</label>
                            <input type="number" id="quote-edit-declared-value" min="0" step="0.01" placeholder="0.00">
                            <small>Client declared value of goods</small>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <label>Price List</label>
                        <select id="quote-edit-price-list-id">
                            <option value="">Select price list...</option>
                            <!-- Price lists will be populated dynamically -->
                        </select>
                        <small>Associated price list for this quote</small>
                    </div>
                </div>

                <!-- Pricing Breakdown -->
                <div class="form-section">
                    <h3>Pricing Breakdown</h3>
                    
                    <!-- Quote Items Summary -->
                    <div style="margin-bottom: 1rem;">
                        <label>Quote Items</label>
                        <div id="quote-edit-items-summary" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 0.75rem; min-height: 60px;">
                            <div style="text-align: center; color: #6b7280; font-size: 0.875rem;">
                                No items added. Use Quote Builder to add detailed items.
                            </div>
                        </div>
                        <small>Detailed quote items managed in Quote Builder</small>
                    </div>

                    <!-- Additional Costs -->
                    <div style="margin-bottom: 1rem;">
                        <label>Other Costs</label>
                        <textarea id="quote-edit-other-costs" rows="2" placeholder="Additional costs not in standard price list (JSON format: [{&quot;description&quot;: &quot;Special transport&quot;, &quot;amount&quot;: 150.00}])"></textarea>
                        <small>JSON array of additional cost items</small>
                    </div>

                    <!-- Recycling & Environmental -->
                    <div style="margin-bottom: 1rem;">
                        <label>Recycling Charges</label>
                        <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                            <div>
                                <label>Recycling Fee (£)</label>
                                <input type="number" id="quote-edit-recycling-fee" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div>
                                <label>Environmental Fee (£)</label>
                                <input type="number" id="quote-edit-environmental-fee" min="0" step="0.01" placeholder="0.00">
                            </div>
                        </div>
                        <small>Environmental and recycling charges</small>
                    </div>

                    <!-- Rebates & Discounts -->
                    <div>
                        <label>Rebates</label>
                        <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                            <div>
                                <label>Volume Rebate (£)</label>
                                <input type="number" id="quote-edit-volume-rebate" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div>
                                <label>Loyalty Rebate (£)</label>
                                <input type="number" id="quote-edit-loyalty-rebate" min="0" step="0.01" placeholder="0.00">
                            </div>
                        </div>
                        <small>Customer rebates and incentives</small>
                    </div>
                </div>

                <!-- Description -->
                <div class="form-section">
                    <h3>Description</h3>
                    <div>
                        <label>Quote Description</label>
                        <textarea id="quote-edit-description" rows="4" placeholder="Detailed description of the quote..."></textarea>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="primary">Update Quote</button>
                    <button type="button" onclick="window.closeQuoteEditModal()" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PC Number Edit Modal -->
    <div id="pc-edit-modal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <h2 id="pc-edit-modal-title">Edit PC Number</h2>
            <form id="pc-edit-form" novalidate>
                <input type="hidden" id="pc-edit-id">
                
                <!-- Hidden PC Number -->
                <input type="hidden" id="pc-edit-number">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-grid">
                        <div>
                            <label>Status</label>
                            <div id="pc-edit-status-label" style="padding: 0.5rem 0; color: #374151; font-weight: 600;">Draft</div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div>
                            <label>Company Name *</label>
                            <input type="text" id="pc-edit-company" required placeholder="Enter company name">
                        </div>
                        <div>
                                <label>Project Name</label>
                                <input type="text" id="pc-edit-title" placeholder="Enter project name">
                        </div>
                        <div>
                            <label>Account Manager *</label>
                            <input type="text" id="pc-edit-account-manager" placeholder="Account manager name">
                        </div>
                    </div>
                    <div>
                        <label>Project Description</label>
                        <textarea id="pc-edit-description" rows="3" placeholder="Describe the project requirements, scope, and any special considerations..."></textarea>
                    </div>
                </div>
                
                <!-- Client Details (Account Manager moved to Basic Information) -->
                <div class="form-section" style="display:none;"></div>
                
                <!-- Classification & Management -->
                <div class="form-section">
                    <h3>Classification & Management</h3>
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div>
                            <label>Industry</label>
                            <select id="pc-edit-industry">
                                <option value="">Select industry...</option>
                                <option value="Business Services (Consulting & Accounting)">Business Services (Consulting & Accounting)</option>
                                <option value="Charities & Non-Profit">Charities & Non-Profit</option>
                                <option value="Construction & Real Estate">Construction & Real Estate</option>
                                <option value="Defence">Defence</option>
                                <option value="Financial Services">Financial Services</option>
                                <option value="Government / Public Administration">Government / Public Administration</option>
                                <option value="Healthcare & NHS">Healthcare & NHS</option>
                                <option value="Legal">Legal</option>
                                <option value="Life Sciences & Pharmaceuticals">Life Sciences & Pharmaceuticals</option>
                                <option value="Logistics & Transportation">Logistics & Transportation</option>
                                <option value="Manufacturing & Engineering">Manufacturing & Engineering</option>
                                <option value="Media & Entertainment">Media & Entertainment</option>
                                <option value="Police & Emergency Services">Police & Emergency Services</option>
                                <option value="Retail & E-commerce">Retail & E-commerce</option>
                                <option value="Technology & Software">Technology & Software</option>
                                <option value="Telecommunications">Telecommunications</option>
                            </select>
                        </div>
                        <div>
                            <label>Client Category</label>
                            <select id="pc-edit-client-category">
                                <option value="">Select category...</option>
                                <option value="public">Public</option>
                                <option value="private">Private</option>
                                <option value="non-profit">Non-Profit</option>
                            </select>
                        </div>
                        <div>
                            <label>Client Source</label>
                                <select id="pc-edit-client-source">
                                    <option value="External">External</option>
                                    <option value="Internal CFA UK">Internal CFA UK</option>
                                    <option value="Internal CIM UK">Internal CIM UK</option>
                                    <option value="Internal Crown APAC">Internal Crown APAC</option>
                                    <option value="Internal Crown EMEA">Internal Crown EMEA</option>
                                    <option value="Internal CWS IT Renew">Internal CWS IT Renew</option>
                                    <option value="Internal CWS Interiors">Internal CWS Interiors</option>
                                    <option value="Internal CWS Office Resale">Internal CWS Office Resale</option>
                                </select>
                        </div>
                        <div>
                            <label>Client Source Detail</label>
                                <select id="pc-edit-client-source-detail">
                                    <option value="">Select detail...</option>
                                    <option value="Cold Outreach">Cold Outreach</option>
                                    <option value="Direct Enquiry">Direct Enquiry</option>
                                    <option value="Email Campaign">Email Campaign</option>
                                    <option value="Existing Client">Existing Client</option>
                                    <option value="Media/PR">Media/PR</option>
                                    <option value="Networking Event">Networking Event</option>
                                    <option value="Online Marketplace/Directory">Online Marketplace/Directory</option>
                                    <option value="Partner/Reseller">Partner/Reseller</option>
                                    <option value="PPC/Ads">PPC/Ads</option>
                                    <option value="RFP/Tender Portal">RFP/Tender Portal</option>
                                    <option value="Social Media">Social Media</option>
                                    <option value="Trade Show/Exhibition">Trade Show/Exhibition</option>
                                    <option value="Web Enquiry">Web Enquiry</option>
                                </select>
                        </div>
                    </div>

                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div>
                            <label>SIC Code 1</label>
                            <input type="text" id="pc-edit-sic-code-1" placeholder="Primary SIC code">
                            <small>Standard Industrial Classification</small>
                        </div>
                        <div>
                            <label>SIC Code 2</label>
                            <input type="text" id="pc-edit-sic-code-2" placeholder="Secondary SIC code">
                        </div>
                        <div>
                            <label>SIC Code 3</label>
                            <input type="text" id="pc-edit-sic-code-3" placeholder="Tertiary SIC code">
                        </div>
                    </div>
                </div>
                
                <!-- Contact & Address (new schema) -->
                <div class="form-section">
                    <h3>Contact & Address</h3>
                    <div class="form-grid">
                        <div>
                            <label>First Name *</label>
                            <input type="text" id="pc-edit-contact-first-name" placeholder="First name">
                        </div>
                        <div>
                            <label>Last Name *</label>
                            <input type="text" id="pc-edit-contact-last-name" placeholder="Last name">
                        </div>
                        <div>
                            <label>Client Title</label>
                            <input type="text" id="pc-edit-contact-client-title" placeholder="e.g. Mr, Ms, Dr, ...">
                        </div>
                        <div>
                            <label>Client Job Title</label>
                            <input type="text" id="pc-edit-contact-job-title" placeholder="e.g. Operations Manager">
                        </div>
                        <div>
                            <label>Phone Number</label>
                            <input type="tel" id="pc-edit-contact-phone" placeholder="+44 20 7123 4567">
                        </div>
                        <div>
                            <label>Email Address</label>
                            <input type="email" id="pc-edit-contact-email" placeholder="email@address.com">
                        </div>
                    </div>
                    <div class="form-grid" style="margin-top: 1rem;">
                        <div>
                            <label>Postcode *</label>
                            <input type="text" id="pc-edit-address-postcode" placeholder="SW1A 1AA">
                        </div>
                        <div>
                            <label>Address Line 1</label>
                            <input type="text" id="pc-edit-address-1" placeholder="Building number and street">
                        </div>
                        <div>
                            <label>Address Line 2</label>
                            <input type="text" id="pc-edit-address-2" placeholder="Floor, suite, apartment">
                        </div>
                        <div>
                            <label>Address Line 3</label>
                            <input type="text" id="pc-edit-address-3" placeholder="District/area">
                        </div>
                        <div>
                            <label>Address Line 4</label>
                            <input type="text" id="pc-edit-address-4" placeholder="City/town">
                        </div>
                            <div>
                                <label>Country</label>
                                <input type="text" id="pc-edit-address-country" value="United Kingdom" placeholder="United Kingdom">
                            </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="primary">Update PC Number</button>
                    <button type="button" onclick="window.closePcEditModal()" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="activity-modal" class="modal"><div class="modal-content">
        <h2 id="activity-modal-title">New Activity</h2>
        <form id="activity-form">
            <input type="hidden" id="activity-id">
        
        <!-- Basic Info Section -->
        <div class="form-section">
            <h3>Basic Information</h3>
        <div class="form-grid">
                <div>
                    <label>Quote *</label>
                    <select id="activity-quote-select"></select>
                    <button type="button" onclick="app.autoFillActivityFromQuote(document.getElementById('activity-quote-select').value)" 
                            style="margin-top: 0.25rem; padding: 0.25rem 0.5rem; font-size: 0.75rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem;">
                        🔄 Auto-fill from Quote
                    </button>
                </div>
                <div><label>Activity Type *</label><input type="text" id="activity-type" placeholder="e.g. Survey, Delivery, Installation" required></div>
                <div><label>Priority</label><select id="activity-priority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                    <option value="urgent">Urgent</option>
                </select></div>
                <div><label>Status</label><select id="activity-status">
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select></div>
        </div>
            <div>
                <label>Activity Title *</label>
                <input type="text" id="activity-title" placeholder="Brief description of the activity" required>
            </div>
            <div>
                <label>Description</label>
                <textarea id="activity-description" rows="2" placeholder="Detailed activity description..."></textarea>
            </div>
        </div>
        
        <!-- Scheduling Section -->
        <div class="form-section">
            <h3>Scheduling</h3>
            <div class="form-grid">
                <div><label>Scheduled Date</label><input type="date" id="activity-scheduled-date"></div>
                <div><label>Scheduled Time</label><input type="time" id="activity-scheduled-time"></div>
                <div><label>Duration (hours)</label><input type="number" id="activity-duration" step="0.5" min="0" placeholder="e.g. 2.5"></div>
                <div><label>Assigned To</label><input type="text" id="activity-assigned-to-name" placeholder="Person responsible"></div>
            </div>
        </div>
        
        <!-- Location & Contact Section -->
        <div class="form-section">
            <h3>Location & Contact</h3>
            <div class="form-grid">
                <div><label>Location</label><input type="text" id="activity-location" placeholder="e.g. Client Site - Birmingham"></div>
                <div><label>Contact Name</label><input type="text" id="activity-contact-name" placeholder="Site contact person"></div>
                <div><label>Contact Phone</label><input type="tel" id="activity-contact-phone" placeholder="Contact phone number" pattern="[0-9\s\+\-\(\)\.]+" title="Please enter a valid phone number"></div>
            </div>
        </div>
        
        <!-- Completion Section (shown only for completed activities) -->
        <div class="form-section" id="activity-completion-section" style="display: none;">
            <h3>Completion Details</h3>
            <div>
                <label>Completion Notes</label>
                <textarea id="activity-completion-notes" rows="3" placeholder="Notes about the completed activity..."></textarea>
            </div>
        </div>
        
        <!-- NEW Sprint 4.3: Resource Allocation Section -->
        <div class="form-section">
            <h3>Resource Allocation</h3>
            <div style="margin-bottom: 1rem;">
                <label>Required Resources</label>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                    <button type="button" onclick="window.showActivityResourceSelector()" class="resource-action-btn primary">
                        🔧 Select Resources
                    </button>
                    <button type="button" onclick="window.checkResourceAvailability()" class="resource-action-btn">
                        ✓ Check Availability
                    </button>
                </div>
            </div>
            <div id="activity-resources-list" style="background: #f9fafb; border-radius: 0.5rem; padding: 0.75rem; min-height: 60px;">
                <div id="activity-resources-empty" style="text-align: center; color: #6b7280; font-size: 0.875rem; padding: 1rem;">
                    No resources selected. Click "Select Resources" to add equipment, vehicles, materials, or tools.
                </div>
                <div id="activity-resources-items" style="display: none;">
                    <!-- Selected resources will be populated here -->
                </div>
            </div>
            <div id="activity-resource-conflicts" style="display: none;">
                <!-- Resource conflicts will be shown here -->
            </div>
        </div>
        


        <!-- Management & Timing Section -->
        <div class="form-section">
            <h3>Management & Timing</h3>
            <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div>
                    <label>Department</label>
                    <select id="activity-department">
                        <option value="">Select department...</option>
                        <option value="Survey Team">Survey Team</option>
                        <option value="Operations">Operations</option>
                        <option value="Installation">Installation</option>
                        <option value="Logistics">Logistics</option>
                        <option value="Administration">Administration</option>
                        <option value="Customer Service">Customer Service</option>
                    </select>
                </div>
                <div>
                    <label>Payment Type</label>
                    <select id="activity-payment-type">
                        <option value="">Select payment type...</option>
                        <option value="Standard Rate">Standard Rate</option>
                        <option value="Overtime Rate">Overtime Rate</option>
                        <option value="Weekend Rate">Weekend Rate</option>
                        <option value="Emergency Rate">Emergency Rate</option>
                        <option value="Contract Rate">Contract Rate</option>
                        <option value="Fixed Price">Fixed Price</option>
                    </select>
                </div>
                <div>
                    <label>Activity Number</label>
                    <input type="text" id="activity-number" placeholder="ACT-2024-001">
                </div>
            </div>

            <div class="form-grid" style="grid-template-columns: repeat(4, 1fr); margin-top: 1rem;">
                <div>
                    <label>Depot Start Time</label>
                    <input type="time" id="activity-time-depot-start">
                    <small>Time leaving depot</small>
                </div>
                <div>
                    <label>Site Start Time</label>
                    <input type="time" id="activity-time-site-start">
                    <small>Arrival at site</small>
                </div>
                <div>
                    <label>Site Finish Time</label>
                    <input type="time" id="activity-time-site-finish">
                    <small>Departure from site</small>
                </div>
                <div>
                    <label>Depot Finish Time</label>
                    <input type="time" id="activity-time-depot-finish">
                    <small>Return to depot</small>
                </div>
            </div>

            <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 1rem;">
                <div>
                    <label>Total Hours</label>
                    <input type="number" id="activity-hours" step="0.25" min="0" placeholder="8.0">
                    <small>Calculated or manual entry</small>
                </div>
                <div>
                    <label>Moveman Job</label>
                    <input type="text" id="activity-moveman-job" placeholder="MJ-001">
                </div>
                <div>
                    <label>CRM ID</label>
                    <input type="text" id="activity-crm-id" placeholder="CRM-SF-12345">
                </div>
            </div>
        </div>

        <!-- Professional Details Section -->
        <div class="form-section">
            <h3>Professional Details</h3>
            <div>
                <label>Instructions</label>
                <textarea id="activity-instructions" rows="3" placeholder="Special instructions, safety requirements, access details..."></textarea>
            </div>
        </div>

        <!-- Logistics & Requirements Section -->
        <div class="form-section">
            <h3>Logistics & Requirements</h3>
            <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="activity-parking-required">
                    <label for="activity-parking-required" style="margin: 0;">Parking Required</label>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="activity-confirmed">
                    <label for="activity-confirmed" style="margin: 0;">Confirmed</label>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="activity-risk-assessment-needed">
                    <label for="activity-risk-assessment-needed" style="margin: 0;">Risk Assessment Needed</label>
                </div>
            </div>
        </div>

        <!-- Address Management Section -->
        <div class="form-section">
            <h3>Address Management</h3>
            
            <!-- Collection Address -->
            <div style="margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 0.75rem 0; color: #374151;">Collection Address</h4>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div>
                        <label>Address Line 1</label>
                        <input type="text" id="activity-collection-address-1" placeholder="Building number and street">
                    </div>
                    <div>
                        <label>Address Line 2</label>
                        <input type="text" id="activity-collection-address-2" placeholder="Floor, suite, apartment">
                    </div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 0.5rem;">
                    <div>
                        <label>City</label>
                        <input type="text" id="activity-collection-city" placeholder="City/town">
                    </div>
                    <div>
                        <label>Postcode</label>
                        <input type="text" id="activity-collection-postcode" placeholder="SW1A 1AA">
                    </div>
                    <div>
                        <label>Country</label>
                        <select id="activity-collection-country">
                            <option value="">Select country...</option>
                            <option value="United Kingdom" selected>United Kingdom</option>
                            <option value="Ireland">Ireland</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); margin-top: 0.5rem;">
                    <div>
                        <label>Contact Name</label>
                        <input type="text" id="activity-collection-contact" placeholder="Collection contact person">
                    </div>
                    <div>
                        <label>Contact Phone</label>
                        <input type="tel" id="activity-collection-phone" placeholder="+44 20 7123 4567">
                    </div>
                </div>
            </div>

            <!-- Delivery Address -->
            <div>
                <h4 style="margin: 0 0 0.75rem 0; color: #374151;">Delivery Address</h4>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div>
                        <label>Address Line 1</label>
                        <input type="text" id="activity-delivery-address-1" placeholder="Building number and street">
                    </div>
                    <div>
                        <label>Address Line 2</label>
                        <input type="text" id="activity-delivery-address-2" placeholder="Floor, suite, apartment">
                    </div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 0.5rem;">
                    <div>
                        <label>City</label>
                        <input type="text" id="activity-delivery-city" placeholder="City/town">
                    </div>
                    <div>
                        <label>Postcode</label>
                        <input type="text" id="activity-delivery-postcode" placeholder="SW1A 1AA">
                    </div>
                    <div>
                        <label>Country</label>
                        <select id="activity-delivery-country">
                            <option value="">Select country...</option>
                            <option value="United Kingdom" selected>United Kingdom</option>
                            <option value="Ireland">Ireland</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); margin-top: 0.5rem;">
                    <div>
                        <label>Contact Name</label>
                        <input type="text" id="activity-delivery-contact" placeholder="Delivery contact person">
                    </div>
                    <div>
                        <label>Contact Phone</label>
                        <input type="tel" id="activity-delivery-phone" placeholder="+44 20 7123 4567">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit">Save Activity</button>
            <button type="button" onclick="window.saveActivityAsTemplate()" style="background: #8b5cf6; color: white;">📋 Save as Template</button>
            <button type="button" onclick="window.closeActivityModal()" class="secondary">Cancel</button>
        </div>
        </form>
    </div></div>

    <div id="resource-modal" class="modal"><div class="modal-content" style="max-width: 800px;">
        <h2 id="resource-modal-title">New Resource</h2>
        <form id="resource-form">
            <input type="hidden" id="resource-id">
        
        <!-- Basic Information -->
        <div class="form-section">
            <h3>Basic Information</h3>
            <div class="form-grid">
                <div><label>Resource Name *</label><input type="text" id="resource-name" placeholder="e.g. Fitter, Luton Van, Protection Blankets" required></div>
                <div><label>Category *</label><select id="resource-category" required>
                    <option value="">Select...</option>
                    <option value="labour">Labour</option>
                    <option value="vehicles">Vehicles</option>
                    <option value="material">Material</option>
                    <option value="crates">Crates</option>
                </select></div>
            </div>
        </div>
        
        <!-- Pricing & Units -->
        <div class="form-section">
            <h3>Pricing & Units</h3>
            <div class="form-grid">
                <div><label>Net Cost (£) *</label><input type="number" id="resource-cost" step="0.01" min="0" placeholder="25.00" required></div>
                <div><label>Unit *</label><select id="resource-unit" required>
                    <option value="">Select...</option>
                    <option value="each">Each</option>
                    <option value="hour">Hour</option>
                    <option value="day">Day</option>
                    <option value="week">Week</option>
                    <option value="month">Month</option>
                    <option value="pack">Pack</option>
                    <option value="roll">Roll</option>
                    <option value="sheet">Sheet</option>
                </select></div>
                <div><label>Status *</label><select id="resource-status" required>
                    <option value="available">Available</option>
                    <option value="in-use">In Use</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="unavailable">Unavailable</option>
                </select></div>
            </div>
        </div>

        
        <div class="form-actions">
            <button type="submit">Save Resource</button>
            <button type="button" onclick="window.closeResourceModal()" class="secondary">Cancel</button>
        </div>
        </form>
    </div>        </div>

        <!-- NEW Sprint 3: Enhanced Resource Lookup Modal -->
        <div id="enhanced-resource-lookup-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="window.closeEnhancedResourceModal()">&times;</span>
                <h2>🔍 Add Resources to Quote</h2>
                
                <!-- Search & Filter Section -->
                <div style="margin-bottom: 1.5rem; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 0.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 0.75rem; align-items: center;">

                        <div>
                            <label>Category</label>
                            <select id="resource-category-filter" onchange="window.filterResources()" style="margin-top: 0.25rem;">
                                <option value="">All Categories</option>
                                <option value="labour">Labour</option>
                                <option value="vehicles">Vehicles</option>
                                <option value="material">Material</option>
                                <option value="crates">Crates</option>
                            </select>
                        </div>
                        <div>
                            <label>Status</label>
                            <select id="resource-status-filter" onchange="window.filterResources()" style="margin-top: 0.25rem;">
                                <option value="">All Status</option>
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: #666;">
                        <span id="resource-count">0</span> resources found
                    </p>
                </div>
                
                <!-- Resources Grid -->
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.5rem;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f8fafc; position: sticky; top: 0;">
                            <tr>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Select</th>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Resource</th>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Category</th>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Price</th>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Qty</th>
                                <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Total</th>
                            </tr>
                        </thead>
                        <tbody id="enhanced-resources-list">
                            <!-- Dynamic content populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Bulk Actions -->
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span id="selected-count">0</span> resources selected
                            <button onclick="window.selectAllFilteredResources()" style="margin-left: 1rem;" class="secondary">Select All Visible</button>
                            <button onclick="window.clearResourceSelection()" style="margin-left: 0.5rem;" class="secondary">Clear Selection</button>
                        </div>
                        <div>
                            <button onclick="window.addSelectedResourcesToQuote()" disabled id="add-selected-btn">Add Selected to Quote</button>
                            <button onclick="window.closeEnhancedResourceModal()" class="secondary" style="margin-left: 0.5rem;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
                </div>

        <!-- NEW Sprint 3.2: Bulk Operations Modals -->
        <div id="bulk-quantity-modal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <span class="close" onclick="window.closeBulkQuantityModal()">&times;</span>
                <h2>📊 Update Quantities</h2>
                <p>Update quantities for <span id="bulk-qty-count">0</span> selected line items</p>
                
                <div style="margin: 1.5rem 0;">
                    <label style="display: block; margin-bottom: 0.5rem;">Operation:</label>
                    <select id="bulk-qty-operation" style="width: 100%; margin-bottom: 1rem;">
                        <option value="set">Set all to specific value</option>
                        <option value="multiply">Multiply by factor</option>
                        <option value="add">Add to current</option>
                    </select>
                    
                    <label style="display: block; margin-bottom: 0.5rem;">Value:</label>
                    <input type="number" id="bulk-qty-value" min="0" step="1" placeholder="Enter value" style="width: 100%;">
                </div>
                
                <div style="text-align: right;">
                    <button onclick="window.applyBulkQuantityUpdate()" style="background: #3b82f6; color: white;">Apply Changes</button>
                    <button onclick="window.closeBulkQuantityModal()" class="secondary" style="margin-left: 0.5rem;">Cancel</button>
                </div>
            </div>
        </div>

        <div id="bulk-discount-modal" class="modal">
            <div class="modal-content" style="max-width: 400px;">
                <span class="close" onclick="window.closeBulkDiscountModal()">&times;</span>
                <h2>💰 Apply Discount</h2>
                <p>Apply discount to <span id="bulk-discount-count">0</span> selected line items</p>
                
                <div style="margin: 1.5rem 0;">
                    <label style="display: block; margin-bottom: 0.5rem;">Discount Type:</label>
                    <select id="bulk-discount-type" style="width: 100%; margin-bottom: 1rem;">
                        <option value="percentage">Percentage (%)</option>
                        <option value="fixed">Fixed Amount (£)</option>
                    </select>
                    
                    <label style="display: block; margin-bottom: 0.5rem;">Discount Value:</label>
                    <input type="number" id="bulk-discount-value" min="0" step="0.01" placeholder="Enter discount" style="width: 100%;">
                    
                    <p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">
                        Note: Discount will be applied to unit prices
                    </p>
                </div>
                
                <div style="text-align: right;">
                    <button onclick="window.applyBulkDiscount()" style="background: #10b981; color: white;">Apply Discount</button>
                    <button onclick="window.closeBulkDiscountModal()" class="secondary" style="margin-left: 0.5rem;">Cancel</button>
                </div>
            </div>
                </div>

        <!-- NEW Sprint 3.3: Template Creation/Edit Modal -->
        <div id="template-modal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="window.closeTemplateModal()">&times;</span>
                <h2 id="template-modal-title">Create Quote Template</h2>
                
                <input type="hidden" id="template-id">
                
                <!-- Template Basic Info -->
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label>Template Name *</label>
                            <input type="text" id="template-name" placeholder="e.g. Standard Office Lighting" required>
                        </div>
                        <div>
                            <label>Category *</label>
                            <select id="template-category" required>
                                <option value="">Select category...</option>
                                <option value="electrical">Electrical</option>
                                <option value="lighting">Lighting</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="installation">Installation</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <label>Description</label>
                        <textarea id="template-description" rows="2" placeholder="Brief description of when to use this template..."></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div>
                            <label>Status</label>
                            <select id="template-status">
                                <option value="active">Active</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                        <div>
                            <label>Default VAT Rate (%)</label>
                            <input type="number" id="template-vat-rate" value="20.00" step="0.01" min="0" max="100">
                        </div>
                    </div>
                </div>
                
                <!-- Template Default Terms -->
                <div style="margin-bottom: 1.5rem;">
                    <label>Default Terms & Conditions</label>
                    <textarea id="template-terms" rows="3" placeholder="Default terms for quotes created from this template...">Payment terms: 30 days net. All work carried out to current industry standards. Materials warranty as per manufacturer specifications.</textarea>
                </div>
                
                <!-- Template Items Preview -->
                <div style="margin-bottom: 1.5rem;">
                    <h4>Template Items</h4>
                    <div id="template-items-preview" style="max-height: 200px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem;">
                        <p style="margin: 0; color: #666; text-align: center;">Create template from current quote items or add items manually</p>
                    </div>
                    <div style="margin-top: 0.5rem; text-align: center;">
                        <button onclick="window.addItemsToTemplate()" class="secondary">+ Add Items to Template</button>
                    </div>
                </div>
                
                <div style="text-align: right;">
                    <button onclick="window.saveTemplate()">Save Template</button>
                    <button onclick="window.closeTemplateModal()" class="secondary" style="margin-left: 0.5rem;">Cancel</button>
                </div>
            </div>
        </div>

        <!-- NEW Sprint 4.1: Activity Template Creation/Edit Modal -->
        <div id="activity-template-modal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <span class="close" onclick="window.closeActivityTemplateModal()">&times;</span>
                <h2 id="activity-template-modal-title">Create Activity Template</h2>
                
                <input type="hidden" id="activity-template-id">
                
                <!-- Template Basic Info -->
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label>Template Name *</label>
                            <input type="text" id="activity-template-name" placeholder="e.g. Standard Site Survey" required>
                        </div>
                        <div>
                            <label>Category *</label>
                            <select id="activity-template-category" required>
                                <option value="">Select category...</option>
                                <option value="survey">Survey</option>
                                <option value="installation">Installation</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="testing">Testing</option>
                                <option value="documentation">Documentation</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <label>Description</label>
                        <textarea id="activity-template-description" rows="2" placeholder="Brief description of when to use this template..."></textarea>
                    </div>
                </div>
                
                <!-- Activity Details -->
                <div style="margin-bottom: 1.5rem;">
                    <h4>Activity Configuration</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div>
                            <label>Priority *</label>
                            <select id="activity-template-priority" required>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div>
                            <label>Duration (hours)</label>
                            <input type="number" id="activity-template-duration" step="0.5" min="0.5" placeholder="2.0">
                        </div>
                        <div>
                            <label>Status</label>
                            <select id="activity-template-status">
                                <option value="active">Active</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Auto-assignment Rules -->
                <div style="margin-bottom: 1.5rem;">
                    <h4>Auto-assignment & Scheduling</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label>Default Assigned To</label>
                            <input type="text" id="activity-template-assigned-to" placeholder="e.g. Mike Johnson">
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.875rem; color: #666;">Leave empty for manual assignment</p>
                        </div>
                        <div>
                            <label>Auto-schedule (days from PC creation)</label>
                            <input type="number" id="activity-template-schedule-offset" min="0" placeholder="1">
                            <p style="margin: 0.25rem 0 0 0; font-size: 0.875rem; color: #666;">0 = same day, 1 = next day, etc.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Template Instructions -->
                <div style="margin-bottom: 1.5rem;">
                    <h4>Template Instructions</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label>Pre-activity Checklist</label>
                            <textarea id="activity-template-checklist" rows="3" placeholder="• Confirm appointment with client
• Prepare tools and equipment
• Review site access instructions"></textarea>
                        </div>
                        <div>
                            <label>Completion Notes Template</label>
                            <textarea id="activity-template-completion-notes" rows="3" placeholder="Activity completed successfully.

Key findings:
•

Next steps:
•"></textarea>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: right;">
                    <button onclick="window.saveActivityTemplate()">Save Template</button>
                    <button onclick="window.closeActivityTemplateModal()" class="secondary" style="margin-left: 0.5rem;">Cancel</button>
                </div>
            </div>
        </div>

    <div id="add-resource-modal" class="modal"><div class="modal-content" style="max-width: 500px;">
        <h2>Add item to Price List</h2>
        <label>Select Resource *</label><select id="modal-resource-item-select"></select>
        <div id="resource-info" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa;"></div>
        <label>Client Price (£) *</label><input type="number" id="modal-client-price" step="0.01" min="0" oninput="window.calculateMargin()">
        <div id="margin-info" style="margin-top: 0.5rem;"></div>
        <div class="form-actions">
             <button onclick="window.addResourceToPriceList()">Add to Price List</button>
            <button onclick="window.closeAddResourceModal()" class="secondary">Cancel</button>
        </div>
    </div></div>

    <!-- NEW Sprint 4.3: Activity Resource Selector Modal -->
    <div id="activity-resource-selector-modal" class="modal"><div class="modal-content" style="max-width: 900px;">
        <h2>🔧 Select Resources for Activity</h2>
        
        <!-- Resource Search and Filter -->
        <div style="margin-bottom: 1rem;">
            <div style="display: flex; gap: 0.75rem; margin-bottom: 0.75rem;">

                <select id="resource-selector-type-filter" onchange="window.filterActivityResourceSelector()"
                        style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                    <option value="">All Types</option>
                    <option value="equipment">Equipment</option>
                    <option value="vehicle">Vehicles</option>
                    <option value="material">Materials</option>
                    <option value="tool">Tools</option>
                </select>
            </div>
        </div>

        <!-- Resource Selection Grid -->
        <div id="resource-selector-grid" style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 0.5rem;">
            <!-- Resources will be populated here -->
        </div>

        <!-- Selected Resources Summary -->
        <div style="margin-top: 1rem; padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; border: 1px solid #bbf7d0;">
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Selected Resources:</div>
            <div id="resource-selector-summary" style="font-size: 0.875rem; color: #166534;">
                No resources selected
            </div>
        </div>

        <div class="form-actions">
            <button onclick="window.confirmActivityResourceSelection()" class="primary">Confirm Selection</button>
            <button onclick="window.closeActivityResourceSelector()" class="secondary">Cancel</button>
        </div>
    </div></div>

    <!-- NEW Sprint 4.4: Dependency Selector Modal -->
    <div id="dependency-selector-modal" class="modal"><div class="modal-content" style="max-width: 800px;">
        <h2>🔗 Select Activity Dependencies</h2>
        
        <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem;">
            <div id="dependency-selector-info" style="font-size: 0.875rem; color: #0c4a6e;">
                <!-- Information about dependency type will be shown here -->
            </div>
        </div>
        
        <!-- Activity Search and Filter -->
        <div style="margin-bottom: 1rem;">
            <div style="display: flex; gap: 0.75rem; margin-bottom: 0.75rem;">

                <select id="dependency-selector-status-filter" onchange="window.filterDependencySelector()"
                        style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="in_progress">In Progress</option>
                    <option value="completed">Completed</option>
                </select>
                <select id="dependency-selector-pc-filter" onchange="window.filterDependencySelector()"
                        style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem;">
                    <option value="">All PC Numbers</option>
                    <!-- PC options will be populated -->
                </select>
            </div>
        </div>

        <!-- Activity Selection List -->
        <div id="dependency-selector-list" style="max-height: 350px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 0.5rem;">
            <!-- Activities will be populated here -->
        </div>

        <!-- Dependency Type Options -->
        <div style="margin-top: 1rem; padding: 0.75rem; background: #f9fafb; border-radius: 0.5rem;">
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Dependency Type:</div>
            <div style="display: flex; gap: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                    <input type="radio" name="dependencyType" value="finish-to-start" checked>
                    Finish-to-Start (Default)
                </label>
                <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                    <input type="radio" name="dependencyType" value="start-to-start">
                    Start-to-Start
                </label>
                <label style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;">
                    <input type="radio" name="dependencyType" value="finish-to-finish">
                    Finish-to-Finish
                </label>
            </div>
        </div>

        <div class="form-actions">
            <button onclick="window.confirmDependencySelection()" class="primary">Add Dependency</button>
            <button onclick="window.closeDependencySelector()" class="secondary">Cancel</button>
        </div>
    </div></div>

    <!-- Price List Edit Modal -->
    <div id="pricelist-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h2 id="pricelist-modal-title">Edit Price List</h2>
            <form id="pricelist-form">
                <input type="hidden" id="pricelist-id">
                
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-grid">
                        <div>
                            <label>Price List Name *</label>
                            <input type="text" id="pricelist-name" required placeholder="Office Relocation - Small Business">
                        </div>
                        <div>
                            <label>Category *</label>
                            <select id="pricelist-category" required>
                                <option value="">Select...</option>
                                <option value="Office Relocation">Office Relocation</option>
                                <option value="Equipment & Materials">Equipment & Materials</option>
                                <option value="Emergency Services">Emergency Services</option>
                                <option value="Specialist Services">Specialist Services</option>
                                <option value="Storage & Logistics">Storage & Logistics</option>
                            </select>
                        </div>
                        <div>
                            <label>Region</label>
                            <select id="pricelist-region">
                                <option value="">Select...</option>
                                <option value="London & M25">London & M25</option>
                                <option value="London & Home Counties">London & Home Counties</option>
                                <option value="UK National">UK National</option>
                                <option value="UK & Europe">UK & Europe</option>
                                <option value="Local Area">Local Area</option>
                            </select>
                        </div>
                        <div>
                            <label>Currency</label>
                            <select id="pricelist-currency">
                                <option value="GBP">GBP (£)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="USD">USD ($)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label>Description</label>
                        <textarea id="pricelist-description" rows="3" placeholder="Detailed description of this price list and its intended use..."></textarea>
                    </div>
                </div>
                
                <!-- Validity & Status -->
                <div class="form-section">
                    <h3>Validity & Status</h3>
                    <div class="form-grid">
                        <div>
                            <label>Valid From</label>
                            <input type="date" id="pricelist-valid-from">
                        </div>
                        <div>
                            <label>Valid Until</label>
                            <input type="date" id="pricelist-valid-until">
                        </div>
                        <div>
                            <label>Status</label>
                            <select id="pricelist-status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="draft">Draft</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Items Section (Read-only for now) -->
                <div class="form-section">
                    <h3>Price List Items</h3>
                    <p style="color: #6b7280; font-style: italic; margin-bottom: 1rem;">
                        Note: Individual item editing will be available in a future update. This form updates the price list metadata only.
                    </p>
                    <div id="pricelist-items-preview" style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem; max-height: 200px; overflow-y: auto;">
                        <!-- Items will be displayed here for preview -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit">Update Price List</button>
                    <button type="button" onclick="window.closePriceListModal()" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Price List Item Edit Modal -->
    <div id="pricelist-item-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2 id="pricelist-item-modal-title">Edit Price List Item</h2>
            <form id="pricelist-item-form">
                <input type="hidden" id="pricelist-item-pricelist-id">
                <input type="hidden" id="pricelist-item-index">
                
                <!-- Item Information -->
                <div class="form-section">
                    <h3>Item Details</h3>
                    <div class="form-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div style="grid-column: 1 / -1;">
                            <label>Description *</label>
                            <input type="text" id="pricelist-item-description" required placeholder="Office desk relocation">
                        </div>
                        <div>
                            <label>Category</label>
                            <select id="pricelist-item-category">
                                <option value="">Select category...</option>
                                <option value="Furniture">Furniture</option>
                                <option value="Equipment">Equipment</option>
                                <option value="Labor">Labor</option>
                                <option value="Transport">Transport</option>
                                <option value="Materials">Materials</option>
                                <option value="Storage">Storage</option>
                                <option value="Services">Services</option>
                            </select>
                        </div>
                        <div>
                            <label>Unit</label>
                            <select id="pricelist-item-unit">
                                <option value="each">Each</option>
                                <option value="hour">Hour</option>
                                <option value="day">Day</option>
                                <option value="m3">Cubic Meter</option>
                                <option value="kg">Kilogram</option>
                                <option value="mile">Mile</option>
                                <option value="set">Set</option>
                                <option value="box">Box</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pricing Information -->
                <div class="form-section">
                    <h3>Pricing</h3>
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div>
                            <label>Net Cost (£) *</label>
                            <input type="number" id="pricelist-item-price" required min="0" step="0.01" placeholder="25.00">
                            <small>Cost per unit (excluding VAT)</small>
                        </div>
                        <div>
                            <label>Margin (%)</label>
                            <input type="number" id="pricelist-item-margin" min="0" max="1000" step="0.1" placeholder="20" value="20">
                            <small>Markup percentage</small>
                        </div>
                        <div>
                            <label>Client Price (£)</label>
                            <input type="number" id="pricelist-item-client-price" readonly step="0.01" style="background: #f3f4f6;">
                            <small>Auto-calculated from cost + margin</small>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <h3>Additional Information</h3>
                    <div>
                        <label>Notes</label>
                        <textarea id="pricelist-item-notes" rows="3" placeholder="Special requirements, handling notes, etc."></textarea>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit">Save Item</button>
                    <button type="button" onclick="window.closePriceListItemModal()" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
